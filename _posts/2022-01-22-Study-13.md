---
title: "13ì£¼ì°¨ ê²Œì‹œíŒ ë§Œë“¤ê¸° 2ë‹¨ê³„"
excerpt: "2022-01-17 ~ 2022-01-21"

toc: true
toc_sticky: true
categories:
  - Study
---
<br>
# ê²Œì‹œíŒ ì‘ì„±ì¼ í¬ë§·
---
ê²Œì‹œê¸€ ì‘ì„±ì¼ì„ DBì— SYSDATEë¡œ INSERT<br>
=> `Sun Jan 16 17:14:12 KST 2022` í¬ë§·ìœ¼ë¡œ ì¶œë ¥ë¨<br>
<br>
JSP taglibë¥¼ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” í¬ë§·ìœ¼ë¡œ ì¶œë ¥ ê°€ëŠ¥<br>
<br>

```jsp
<%-- formatting library --%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<%-- ì¤‘ê°„ ìƒëµ --%>
<body>
<td><fmt:formatDate value="${data.boardVO.board_writedate }" pattern="yy.MM.dd" /></td>
<td><fmt:formatDate value="${data.boardVO.board_writedate }" pattern="yy-MM-dd" /></td>
<td><fmt:formatDate value="${data.boardVO.board_writedate }" pattern="yyë…„MMì›”ddì¼" /></td>
</body>
```

<br>
<br><br>

# ì·¨ë¯¸(Check Box)
---
íšŒì›ê°€ì… í˜ì´ì§€ì— ì·¨ë¯¸ ì²´í¬ë°•ìŠ¤ ì¶”ê°€<br>
radio ë²„íŠ¼ê³¼ëŠ” ë‹¬ë¦¬ check boxëŠ” ì¶”ê°€/ìˆ˜ì •ë˜ëŠ” ì¼ì´ ìˆìŒ(ê°€ë³€ì )<br>


<br><br>

## DB

ì·¨ë¯¸ ëª©ë¡ì„ ì¹´í…Œê³ ë¦¬í™”í•˜ì—¬ DBì— í…Œì´ë¸”ë¡œ ì €ì¥(FP_Hobby_Category)<br>
ë©¤ë²„ì˜ ì·¨ë¯¸ë¥¼ ì €ì¥í•˜ëŠ” DB ì¶”ê°€ ìƒì„±(FP_MemberHobby)<br>
<br>
<br>
**ERD**

<center><img src="https://user-images.githubusercontent.com/57750308/150630229-332bced4-074c-4506-9b60-7220f6d3bca1.png"></center>

<br>

**ë‹¤ì¤‘ ì†ì„±**<br>
- í•˜ë‚˜ì˜ íšŒì›ì€ ì—¬ëŸ¬ ì†ì„±(ì·¨ë¯¸)ë¥¼ ê°–ëŠ”ë‹¤.
- ex) ì‡¼í•‘ëª°/ë°°ë‹¬ì–´í”Œ ë°°ì†¡ì§€ ëª©ë¡
- ë‹¤ì¤‘ ì†ì„± ì²˜ë¦¬
  * ë³„ë„ì˜ ë‹¤ì¤‘ ì†ì„± ì €ì¥ìš© í…Œì´ë¸”ì„ ìƒì„±
  * ë‘ ê°œì˜ í…Œì´ë¸”(Member, HobbyCategory)ê³¼ ê°ê° 1 : N ì˜ ê´€ê³„ë¥¼ ë§ºìŒ
  * í•œ ëª…ì´ ì·¨ë¯¸ë¥¼ ì„ íƒí•˜ì—¬ íšŒì›ê°€ì…í•˜ë©´ ë‘ ê°œì˜ í…Œì´ë¸”(Member, MemberHobby)ì— INSERT ë¨
<br>
<br>

`cf) ë‹¨ì¼ ì†ì„± : í•˜ë‚˜ì˜ íšŒì›ì€ í•˜ë‚˜ì˜ ì†ì„±(ID, PW, ...)ì„ ê°–ëŠ”ë‹¤`<br>
`=> í•´ë‹¹ í…Œì´ë¸”ì— ì†ì„± ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ì—¬ ê°’ ì €ì¥`<br>
<br>

```sql
--ì·¨ë¯¸ ì¹´í…Œê³ ë¦¬ Table
DROP TABLE FP_Hobby_Category;
CREATE TABLE FP_Hobby_Category(
	hobby_category_no NUMBER,
	hobby_category_name VARCHAR2(100)
);

DROP SEQUENCE FP_Hobby_Category_seq;
CREATE SEQUENCE FP_Hobby_Category_seq;

--INSERTë¡œ ì·¨ë¯¸ ëª©ë¡ ì •ì˜(ë‚˜ì¤‘ì— ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥)
INSERT INTO FP_Hobby_Category VALUES(FP_Hobby_Category_seq.nextval, 'ì•¼êµ¬');
INSERT INTO FP_Hobby_Category VALUES(FP_Hobby_Category_seq.nextval, 'ì¶•êµ¬');
INSERT INTO FP_Hobby_Category VALUES(FP_Hobby_Category_seq.nextval, 'ë†êµ¬');
INSERT INTO FP_Hobby_Category VALUES(FP_Hobby_Category_seq.nextval, 'ë‹¹êµ¬');
INSERT INTO FP_Hobby_Category VALUES(FP_Hobby_Category_seq.nextval, 'í…Œë‹ˆìŠ¤');

--ì‚¬ìš©í•  ì¿¼ë¦¬
SELECT * FROM FP_Hobby_Category ORDER BY hobby_category_no ASC;

--ë©¤ë²„ì˜ ì·¨ë¯¸ Table
DROP TABLE FP_MemberHobby;
CREATE TABLE FP_MemberHobby (
	memberhobby_no NUMBER,
	member_no NUMBER,
	hobby_category_no NUMBER
);

DROP SEQUENCE FP_MemberHobby_seq;
CREATE SEQUENCE FP_MemberHobby_seq;

SELECT * FROM FP_MemberHobby;
```

<br>
<br>

## VO
FP_Hobby_Category, FP_MemberHobbyì˜ ì†ì„±ê³¼ ë™ì¼í•œ í•„ë“œëª…ì„ ê°€ì§„ VO ìƒì„±<br>
<br>

```java
// HobbyCategoryVO
package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo;

public class HobbyCategoryVO {
	
	private int hobby_category_no;
	private String hobby_category_name;
	
	public HobbyCategoryVO() {
		super();
	}

	public HobbyCategoryVO(int hobby_category_no, String hobby_category_name) {
		super();
		this.hobby_category_no = hobby_category_no;
		this.hobby_category_name = hobby_category_name;
	}

	public int getHobby_category_no() {
		return hobby_category_no;
	}

	public void setHobby_category_no(int hobby_category_no) {
		this.hobby_category_no = hobby_category_no;
	}

	public String getHobby_category_name() {
		return hobby_category_name;
	}

	public void setHobby_category_name(String hobby_category_name) {
		this.hobby_category_name = hobby_category_name;
	}
}
```

<br>

```java
// MemberHobbyVO
package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo;

public class MemberHobbyVO {
	// í•„ë“œ
	private int memberhobby_no;
	private int member_no;
	private int hobby_category_no;
	// ìƒì„±ì, getter/setter ì‘ì„±
}
```

<br><br>

## Mapper
ì·¨ë¯¸ ê´€ë ¨í•˜ì—¬ í° ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ MemberSQLMapperì— ì‘ì„±<br><br>

í˜„ì¬ `member_no`ëŠ” ë©¤ë²„ í…Œì´ë¸”ì— `FP_MEMBER_seq.nextval`ë¡œ INSERT ë˜ê³  ìˆìŒ<br>
<br>
=> íšŒì›ê°€ì…ì‹œ FP_Member, FP_MemberHobby ë‘ í…Œì´ë¸”ì— `member_no`ê°€ INSERT ë¼ì•¼ í•¨<br>
=> dual í…Œì´ë¸”ì„ ì´ìš©í•˜ì—¬ ë¨¼ì € `FP_Member_seq.nextval`ì„ ë°›ì•„ì˜¨ ë’¤ ë‘ í…Œì´ë¸”ì— INSERT
<br><br>

```java
// MemberSQLMapper interface

// ì·¨ë¯¸ ì¹´í…Œê³ ë¦¬ ê´€ë ¨
public int createMemberPK();
public ArrayList<HobbyCategoryVO> getHobbyCategoryList();
public void insertMemberHobby(MemberHobbyVO vo);
```

<br>

```xml
<!-- MemberSQLMapper.xml -->

<!-- member_no ì¶”ì¶œ -->
<select id="createMemberPK" resultType="int">
	SELECT FP_Member_seq.nextval FROM dual
</select>

<!-- FP_Member_seq.nextvalì—ì„œ member_noë¡œ ìˆ˜ì • -->
<insert id="joinMember">
	INSERT INTO FP_Member VALUES
	(#{member_no},		
	#{member_id},
	#{member_pw},
	#{member_nick},
	#{member_gender},
	#{member_birth},
	#{member_phone},
	#{member_email},
	SYSDATE)
</insert>

<!-- ì·¨ë¯¸ ì¹´í…Œê³ ë¦¬ ê´€ë ¨ -->
<select id="getHobbyCategoryList" resultType="com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.HobbyCategoryVO">
	SELECT *
	FROM FP_Hobby_Category
	ORDER BY hobby_category_no ASC
</select>

<!-- íšŒì› ì·¨ë¯¸ -->
<insert id="insertMemberHobby">
	INSERT INTO FP_MemberHobby VALUES(
	FP_MemberHobby_seq.nextval,
	#{member_no},
	#{hobby_category_no}
	)
</insert>
```

<br>
<br>

## Service

```java
// MemberService

public void joinMember(MemberVO vo, int[] hobby_category_no) {
	// íŒŒë¼ë¯¸í„° ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì½”ì–´ë¡œì§(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§) ìˆ˜í–‰

	// member_no(PK) ë¨¼ì € ìƒì„±
	int memberNo = memberSQLMapper.createMemberPK();
		
	// DB insert
	vo.setMember_no(memberNo);
	memberSQLMapper.joinMember(vo);
		
	if(hobby_category_no != null) {
			
		for(int hcNo : hobby_category_no) {
				
			MemberHobbyVO hVO = new MemberHobbyVO();

			// íšŒì› ë²ˆí˜¸(dualì—ì„œ seq ì¡°íšŒë¡œ ë°›ì•„ì˜¨ ê°’)
			hVO.setMember_no(memberNo);

			// ì·¨ë¯¸ ì¹´í…Œê³ ë¦¬ ë²ˆí˜¸(íšŒì› ê°€ì…ì‹œ ì„ íƒëœ ê°’)
			hVO.setHobby_category_no(hcNo);

			memberSQLMapper.insertMemberHobby(hVO);				
		}
	}
}
```

<br><br>

## Controller

```java
// MemberController

@RequestMapping("joinMemberPage")
public String joinMemberPage(Model model) {
	System.out.println("ì‹œìŠ¤í…œ ë¡œê·¸] íšŒì›ê°€ì… í˜ì´ì§€ ì‹¤í–‰");
		
	ArrayList<HobbyCategoryVO> list = memberService.getHobbyCategoryList();
		
	// modelì— ë„£ì–´ íšŒì›ê°€ì… jspì—ì„œ ì·¨ë¯¸ ëª©ë¡ ì¶œë ¥ ê°€ëŠ¥
	model.addAttribute("hobbyCategoryList", list);
		
	return "member/joinMemberPage";
}

@RequestMapping("joinMemberProcess")
// íšŒì›ê°€ì… í™”ë©´ì—ì„œ ì„ íƒí•œ ì·¨ë¯¸ë“¤ì´ ë°°ì—´ë¡œ ë“¤ì–´ì˜´(int[] hobby_category_no)
public String joinMemberProcess(MemberVO param, int[] hobby_category_no) {
	System.out.println("ì‹œìŠ¤í…œ ë¡œê·¸] íšŒì›ê°€ì… í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰");
	memberService.joinMember(param, hobby_category_no);
		
	return "member/joinMemberComplete";
}
```

<br>
<br>

## JSP

```jsp
<%-- joinMemberPage.jsp --%>
ì·¨ë¯¸ :
<c:forEach items="${hobbyCategoryList }" var="hobbyCategory">
	<input type="checkbox" name="hobby_category_no" value="${hobbyCategory.hobby_category_no }">
	${hobbyCategory.hobby_category_name }
</c:forEach>

```

`=> 1, 3, 5ë²ˆì§¸ ì²´í¬ë°•ìŠ¤ ì„ íƒí–ˆë‹¤ë©´ hobby_category_no=1&hobby_category_no=3&hobby_category_no=5ë¡œ ë„˜ì–´ì˜´`<br>
`(get ë°©ì‹ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥)`


<br>
<br><br>


# HTML escape
---
ì—”í„° ë° íŠ¹ë¬¸ì€ DBì—ì„œëŠ” ì¸ì‹ í•˜ì§€ë§Œ HTMLì—ì„œ ì¸ì‹ ëª» í•¨<br>
=> íƒœê·¸ì™€ ë™ì¼í•œ ë¬¸ìë¥¼ ì…ë ¥í–ˆì„ ê²½ìš° ì¶œë ¥í•˜ë©´ ë¬¸ìì—´ì´ ì•„ë‹Œ HTML ì½”ë“œê°€ ì ìš©ë¼ì„œ ì¶œë ¥ë¨
<br><br>

íŠ¹ìˆ˜ë¬¸ìë¥¼ ë¬¸ì ê·¸ìì²´ë¡œ ì¸ì‹í•˜ëŠ” ì™¸ë¶€ lib ì‚¬ìš©<br>
`ì—”í„°ì™€ ë„ì–´ì“°ê¸°ëŠ” libì—ì„œ ë°”ê¿” ì£¼ì§€ ì•Šì•„ String.replaceAll()ì„ ì‚¬ìš©í•˜ì—¬ <br>ê³¼ &nbsp;ë¡œ ì¹˜í™˜`
<br>
<br>

## pom.xml

```xml
<!--  html escape ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-text</artifactId>
    <version>1.9</version>
</dependency>
```

<br><br>

## Service
ê¸€ ìˆ˜ì •í•  ë•Œë„ `getBoard()`ì—ì„œ ê°€ì ¸ì˜´<br>
=> `replaceAll()`í•œ ì—”í„°ì™€ ë„ì–´ì“°ê¸°ê°€ `<br>, &nbsp;`ë¡œ ë³´ì„<br>
=> `isEscape` íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•˜ì—¬ `true`ì¼ ê²½ìš°(ê¸€ ì½ê¸°)ì—ë§Œ escape ì ìš©<br>
<br>

```java
// BoardService

public HashMap<String, Object> getBoard(int board_no, boolean isEscape) {
    HashMap<String, Object> map = new HashMap<>();
    
    BoardVO boardVO = boardSQLMapper.getBoardByNo(board_no);
    
    // HTML escape
    if(isEscape) {
        String content = boardVO.getBoard_content();
        
        // StringEscapeUtilsê°€ ë‘ ì¢…ë¥˜ ìˆìŒ
        // org.apache.commons.text.StringEscapeUtils ì‚¬ìš©
        content = StringEscapeUtils.escapeHtml4(content);
        
        // ì—”í„°ë¥¼ <br>ë¡œ ì¹˜í™˜(StringEscapeUtilsëŠ” ì—”í„°ë¥¼ <br>ë¡œ ì•ˆ ë°”ê¿”ì¤Œ)
        // HTMLì€ ë„ì–´ì“°ê¸° í•œ ë²ˆë§Œ ì¸ì‹ => ë„ì–´ì“°ê¸°ë¥¼ ë„ì–´ì“°ê¸° íŠ¹ë¬¸ìœ¼ë¡œ ì§ì ‘ ì¹˜í™˜
        // ì§ì ‘ ì½”ë“œ ìƒì—ì„œ ìˆ˜ì •í•´ì•¼í•¨
        content = content.replaceAll("\n", "<br>");
        content = content.replaceAll(" ", "&nbsp;");
        boardVO.setBoard_content(content);
        
        // ì œëª©ì—ë„ escape ì ìš©
        boardVO.setBoard_title(
                StringEscapeUtils.escapeHtml4(boardVO.getBoard_title())
                .replaceAll("\n", "<br>").replaceAll(" ", "&nbsp;"));
    }
            
    int memberNo = boardVO.getMember_no();	
    MemberVO memberVO = memberSQLMapper.getMemberByNo(memberNo);
    
    map.put("memberVO", memberVO);
    map.put("boardVO", boardVO);
    
    return map;
}

public ArrayList<HashMap<String, Object>> getBoardList() {
    ArrayList<HashMap<String, Object>> dataList = new ArrayList<>();
    
    ArrayList<BoardVO> boardVOList = boardSQLMapper.getBoardList();
    
    for(BoardVO boardVO : boardVOList) {
        int memberNo = boardVO.getMember_no();	// ì‘ì„±ì ë²ˆí˜¸			
        
        // ì œëª©ì— escape ì ìš©
        boardVO.setBoard_title(
                StringEscapeUtils.escapeHtml4(boardVO.getBoard_title())
                .replaceAll("\n", "<br>").replaceAll(" ", "&nbsp;"));
        
        // SELECT * FROM FP_Member WHERE member_no = #{no}
        MemberVO memberVO = memberSQLMapper.getMemberByNo(memberNo);
        
        HashMap<String, Object> map = new HashMap<>();
        map.put("memberVO", memberVO);
        map.put("boardVO", boardVO);
        
        dataList.add(map);
    }
    return dataList;
}
```

<br><br>

## Controller

```java
// BoardController

@RequestMapping("readContentPage")
public String readContentPage(int board_no, Model model) {
    boardService.increaseReadCount(board_no);
    
    // ê¸€ ì½ê¸° => escape í•„ìš”(true)
    HashMap<String, Object> map = boardService.getBoard(board_no, true);
    
    model.addAttribute("data", map);
    
    return "board/readContentPage";
}
    
@RequestMapping("updateContentPage")
public String updateContentPage(int board_no, Model model) {

    // ê¸€ ìˆ˜ì • => escape ë¶ˆí•„ìš”(false)
    HashMap<String, Object> map = boardService.getBoard(board_no, false);
    
    model.addAttribute("data", map);
    
    return "board/updateContentPage";
}
```


<br>
<br><br>

# ìµœì‹ ê¸€
---
3ì‹œê°„ ì´ë‚´ì— ì“´ ê¸€ë§Œ ì œëª© ì˜†ì— new í‚¤ì›Œë“œ ë±ƒì§€ ë¶™ì„

<br>

## Service

```java
// BoardService

public ArrayList<HashMap<String, Object>> getBoardList() {
    ArrayList<BoardVO> boardVOList = boardSQLMapper.getBoardList();
    
    ArrayList<HashMap<String, Object>> dataList = new ArrayList<>();
    
    for(BoardVO boardVO : boardVOList) {
        int memberNo = boardVO.getMember_no();	// ì‘ì„±ì ë²ˆí˜¸			
        
        // SELECT * FROM FP_Member WHERE member_no = #{no}
        MemberVO memberVO = memberSQLMapper.getMemberByNo(memberNo);
        
        HashMap<String, Object> map = new HashMap<>();
        map.put("memberVO", memberVO);
        map.put("boardVO", boardVO);
        
        // ê²Œì‹œê¸€ ì‘ì„±ì‹œê°„ì´ (í˜„ì¬ì‹œê°„-3ì‹œê°„) ë³´ë‹¤ í´ ë•Œ(ìˆ«ìë¡œ ë³€í™˜í•˜ì—¬ ì—°ì‚°)
        Date writeDate = boardVO.getBoard_writedate();
        long writeTime = writeDate.getTime();
        
        long currentTime = System.currentTimeMillis();
        long targetTime = currentTime - 1000 * 60 * 60 * 3;
        
        if(writeTime > targetTime) {
            map.put("newKeyword", true);
        }        
        dataList.add(map);
    }
    return dataList;
}
```

<br><br>


## JSP
ìµœì‹ ê¸€ì—ë§Œ ì œëª© ì˜†ì— bootstrap new ë±ƒì§€ ë¶™ì„

```jsp
<%-- mainPage.jsp--%>
<td>
    <a href="./readContentPage?board_no=${data.boardVO.board_no }">${data.boardVO.board_title }</a>
    <c:if test="${!empty data.newKeyword }">
        <span class="badge bg-danger">new</span>
    </c:if>
</td>
```


<br>
<br><br>

# ê²€ìƒ‰
---
select ë°•ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ì œëª©/ë‚´ìš©/ë‹‰ë„¤ì„ìœ¼ë¡œ ê²Œì‹œê¸€ ê²€ìƒ‰ ê¸°ëŠ¥ ì‘ì„±<br>
<br>

## DB

```sql
--ì´ 4ê°œì˜ ì¿¼ë¦¬ í•„ìš”

--ì „ì²´ ê²€ìƒ‰
SELECT * FROM FP_Board
ORDER BY board_no DESC;

--ì œëª© ê²€ìƒ‰
SELECT *
FROM FP_Board
WHERE board_title LIKE '%í•˜í•˜%'
ORDER BY board_no DESC;

--ë‚´ìš© ê²€ìƒ‰
SELECT *
FROM FP_Board
WHERE board_content LIKE '%í•˜í•˜%'
ORDER BY board_no DESC;

--ë‹‰ë„¤ì„ ê²€ìƒ‰
--1.joiní•˜ëŠ” ê²½ìš°
SELECT *
FROM FP_Board, FP_Member
WHERE FP_Board.member_no = FP_Member.member_no
AND FP_Member.member_nick LIKE '%rrr3%'
ORDER BY FP_Board.board_no DESC;

--2.subquery ì‚¬ìš©í•˜ëŠ” ê²½ìš°
SELECT *
FROM FP_Board
WHERE member_no IN(
	SELECT member_no
	FROM FP_Member
	WHERE member_nick LIKE '%rrr3%'
)
ORDER BY board_no DESC;


--ë™ì ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ìœ„ 4ê°œì˜ ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ì˜ ì¿¼ë¦¬ë¡œ í•©ì¹  ìˆ˜ ìˆìŒ
--ë™ì ì¿¼ë¦¬ë¥¼ ìœ„í•œ ì¿¼ë¦¬
SELECT fb.* FROM FP_BOARD fb, FP_MEMBER fm 
WHERE fb.member_no = fm.member_no
--AND fb.board_title LIKE '%í•˜í•˜%'
--AND fb.board_content LIKE '%í•˜í•˜%'
--AND fm.member_nick LIKE '%í•˜í•˜í•˜%'
ORDER BY fb.board_no DESC
;
```

<br><br>

## Mapper
MybatisëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ 1ê°œë§Œ ë°›ì„ ìˆ˜ ìˆìŒ<br>
<br>
íŒŒë¼ë¯¸í„°ê°€ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°<br>
1. íŒŒë¼ë¯¸í„°ë“¤ì„ ë‹´ì„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë„£ìŒ
2. `map`ì— ë„£ì–´ ì „ë‹¬
3. `@Param("keyê°’")` ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© => ë‚´ë¶€ì ìœ¼ë¡œ `HashMap` ìƒì„±ë¨

<br>

```java
// BoardSQLMapper interface

public ArrayList<BoardVO> getBoardList(@Param("searchOption") String searchOption, 
					@Param("searchWord") String searchWord);
```

<br>
MybatisëŠ” xml íŒŒì¼ì—ì„œ ifë¬¸ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ(jsp ë¬¸ë²•ê³¼ í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì£¼ì˜)
- ê³µí†µë˜ëŠ” ë¶€ë¶„ì€ if ë¬¸ ë°–ìœ¼ë¡œ ëº„ ìˆ˜ ìˆìŒ
- ë°˜ë³µë¬¸ë„ ê°€ëŠ¥(foreach ë¬¸)

```xml
<!-- BoardSQLMapper.xml -->

<!-- ë™ì  ì¿¼ë¦¬ -->
<select id="getBoardList" resultType="com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.BoardVO">
	SELECT fb.* FROM FP_BOARD fb, FP_MEMBER fm 
	WHERE fb.member_no = fm.member_no
	<if test="searchOption != null">
		<choose>
			<when test="searchOption == 'title'">
				AND fb.board_title LIKE '%'|| #{searchWord} ||'%'
			</when>
			<when test="searchOption == 'content'">
				AND fb.board_content LIKE '%'|| #{searchWord} ||'%'
			</when>
			<when test="searchOption == 'nick'">
				AND fm.member_nick LIKE '%'|| #{searchWord} ||'%'
			</when>		<!-- otherwiseë„ ìˆìŒ -->
		</choose>
	</if>
	ORDER BY fb.board_no DESC
</select>
```

<br>
<br>

## Service

```java
// BoardService

public ArrayList<HashMap<String, Object>> getBoardList(String searchOption, String searchWord) {
	ArrayList<HashMap<String, Object>> dataList = new ArrayList<>();
		
	ArrayList<BoardVO> boardVOList = boardSQLMapper.getBoardList(searchOption, searchWord);

	// ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¶€ë¶„ ìƒëµ
}
```

<br><br>

## Controller

```java
// BoardController

@RequestMapping("mainPage")
public String mainPage(Model model, String searchOption, String searchWord) {
	System.out.println("ì‹œìŠ¤í…œ ë¡œê·¸] ë©”ì¸ í˜ì´ì§€ ì‹¤í–‰");
		
	ArrayList<HashMap<String, Object>> dataList = boardService.getBoardList(searchOption, searchWord);
	// ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¶€ë¶„ ìƒëµ
}
````

<br><br>

## JSP

```jsp
<%--mainPage.jsp--%>

<form action="./mainPage" method="get">				
<div class="row mt-3">	<%-- ê²€ìƒ‰ --%>
	<div class="col">
		<select name="searchOption" class="form-select">
			<option value="title">ì œëª©</option>
			<option value="content">ë‚´ìš©</option>
			<option value="nick">ë‹‰ë„¤ì„</option>
		</select>
	</div>
	<div class="col-8">
		<input name="searchWord" type="text" class="form-control" placeholder="ê²€ìƒ‰í•  ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
	</div>
	<div class="col d-grid">
		<input type="submit" value="ê²€ìƒ‰" class="btn btn-primary">
	</div>
</div>
</form>
```

<br>
<br><br>

# í˜ì´ì§•
---
í•œ í˜ì´ì§€ì— ê²Œì‹œê¸€ 10ê°œì”© ì¶œë ¥ë˜ë„ë¡ ì‘ì„±<br>
<br><br>

## DB

ğŸ’¡ **ROWNUM**<br>
<br>
`WHERE ROWNUM <= 10` â­•<br>
`WHERE ROWNUM >= 1`  &nbsp;â­•<br>
`WHERE ROWNUM >= 2`  &nbsp;âŒ<br>
<br>
`ROWNUM`ì€ WHEREì ˆë¡œ í…Œì´ë¸”ì„ ë§Œë“¤ê³  ë‚˜ì„œ ë½‘ì•„ì˜¤ëŠ” ê²ƒ<br>
`ROWNUM` 1ì´ ë§Œë“¤ì–´ì§€ì§€ ì•Šì€ ìƒíƒœì—ì„œ 2ë¶€í„° ë½‘ì•„ì˜¤ë ¤ê³ í•´ì„œ ì‹¤í–‰ ì•ˆ ë¨<br>
<br>
FROMì ˆ ì„œë¸Œì¿¼ë¦¬ : ì¿¼ë¦¬ì˜ ì‹¤í–‰ ìˆœì„œë¥¼ ì œì–´í•  ìˆ˜ ìˆìŒ(FROMì ˆì— ìˆëŠ”ê²Œ ë¨¼ì € ì‹¤í–‰ë¨)
<br><br>

```sql
--í˜ì´ì§• ì¿¼ë¦¬(MySQL, PostgreSQLì—ì„œëŠ” ROWNUM ëŒ€ì‹  LIMIT ì‚¬ìš© => ê°™ì€ ë™ì‘ì€ ì•„ë‹˜)

SELECT t1.*, ROWNUM FROM (
	SELECT * FROM FP_BOARD ORDER BY board_no DESC
) t1
WHERE ROWNUM <= 10;


--ìœ„ ì¿¼ë¦¬ë¥¼ ì„œë¸Œì¿¼ë¦¬ë¡œ ì‚¬ìš©í•˜ì—¬ ROWNUMì´ ì´ë¯¸ ë¶™ì–´ìˆëŠ” ì¸ë¼ì¸ ë·°ë¥¼ ë§Œë“¦
--ROWNUMì„ í•˜ë‚˜ì˜ ì»¬ëŸ¼ì²˜ëŸ¼ ì‚¬ìš©ê°€ëŠ¥, ì¤‘ê°„ë¶€í„° ê°’ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
SELECT t2.* FROM (
	SELECT t1.*, ROWNUM AS rnum FROM (
		SELECT * FROM FP_BOARD ORDER BY board_no DESC
	) t1
)t2
WHERE t2.rnum >= 11 AND t2.rnum <= 20;


--í•œ í˜ì´ì§€ì— 10ê°œì”© ë‚˜ì˜¤ëŠ” ê²Œì‹œíŒì˜ 1í˜ì´ì§€
SELECT t2.* FROM (
	SELECT t1.*, ROWNUM AS rnum FROM (
		SELECT * FROM FP_BOARD ORDER BY board_no DESC
	) t1
)t2
WHERE t2.rnum >= (1-1)*10 + 1
AND t2.rnum <= 1 * 10;


--ê²€ìƒ‰ê³¼ í˜ì´ì§• ì¿¼ë¦¬
SELECT t2.* FROM (
	SELECT t1.*, ROWNUM AS rnum FROM (
		SELECT fb.* FROM FP_BOARD fb, FP_MEMBER fm 
		WHERE fb.member_no = fm.member_no
		--AND fb.board_title LIKE '%í•˜í•˜%'
		--AND fb.board_content LIKE '%í•˜í•˜%'
		--AND fm.member_nick LIKE '%rrr3%'
		ORDER BY fb.board_no DESC
	)t1
)t2
WHERE t2.rnum >= (1-1)*10 + 1
AND t2.rnum <= 1 * 10;
;
```

<br><br>

## Mapper

```java
// BoardSQLMapper interface

public ArrayList<BoardVO> getBoardList(
		@Param("searchOption") String searchOption, 
		@Param("searchWord") String searchWord,
		@Param("pageNum") int pageNum); 

// ì´ ê°œìˆ˜ ì¹´ìš´íŒ…
public int getBoardCount(
		@Param("searchOption") String searchOption, 
		@Param("searchWord") String searchWord);
```

<br>

xmlì—ì„œ í¬ê¸° ë¹„êµí•  ë•Œ `<=, >=, <, >`ì˜ êº½ì‡ ë¥¼ íƒœê·¸ë¡œ ì¸ì‹í•¨<br>
=> íŠ¹ìˆ˜ ë¬¸ì ì²˜ë¦¬ í•„ìš”<br>
<br>
`<![CDATA[ ]]>` ì´ìš© : `[ ]` ì•ˆì— ë“¤ì–´ê°€ëŠ” ë¬¸ìëŠ” xml ë¬¸ë²•ì„ ë¬´ì‹œí•˜ê³  ë¬¸ì ê·¸ëŒ€ë¡œ ì¸ì§€<br>
`[ ]` ì•ˆì—ì„œëŠ” íƒœê·¸ê°€ ì•ˆ ë¨¹íˆê¸° ë•Œë¬¸ì— escapeê°€ í•„ìš”í•œ ë¶€ë¶„ì—ë§Œ ì‚¬ìš©<br>

```xml
<!-- BoardSQLMapper.xml -->

<select id="getBoardList" resultType="com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.BoardVO">
    SELECT t2.* FROM (
        SELECT t1.*, ROWNUM AS rnum FROM (
            SELECT fb.* FROM FP_BOARD fb, FP_MEMBER fm 
            WHERE fb.member_no = fm.member_no
            <if test="searchOption != null">
                <choose>
                    <when test="searchOption == 'title'">
                        AND fb.board_title LIKE '%'|| #{searchWord} ||'%'
                    </when>
                    <when test="searchOption == 'content'">
                        AND fb.board_content LIKE '%'|| #{searchWord} ||'%'
                    </when>
                    <when test="searchOption == 'nick'">
                        AND fm.member_nick LIKE '%'|| #{searchWord} ||'%'
                    </when>
                </choose>
            </if>
            ORDER BY fb.board_no DESC) t1
        ) t2
    
    <![CDATA[ 
    WHERE t2.rnum >= (#{pageNum}-1) * 10 + 1
    AND t2.rnum <= #{pageNum} * 10
    ]]>
</select>


<select id="getBoardCount" resultType="int">
    SELECT COUNT(*)
    FROM FP_BOARD fb, FP_MEMBER fm
    WHERE fb.MEMBER_NO = fm.MEMBER_NO
    <if test="searchOption != null">
        <choose>
            <when test="searchOption == 'title'">
                AND fb.board_title LIKE '%'|| #{searchWord} ||'%'
            </when>
            <when test="searchOption == 'content'">
                AND fb.board_content LIKE '%'|| #{searchWord} ||'%'
            </when>
            <when test="searchOption == 'nick'">
                AND fm.member_nick LIKE '%'|| #{searchWord} ||'%'
            </when>
        </choose>
    </if>
</select>
```

<br><br>

## Service

```java
// BoardService

public ArrayList<HashMap<String, Object>> getBoardList(
		String searchOption, String searchWord, int pageNum) {
	ArrayList<HashMap<String, Object>> dataList = new ArrayList<>();
		
	ArrayList<BoardVO> boardVOList = boardSQLMapper.getBoardList(searchOption, searchWord, pageNum);

	// ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¶€ë¶„ ìƒëµ
 }

public int getBoardCount(String searchOption, String searchWord) {
	return boardSQLMapper.getBoardCount(searchOption, searchWord);
}
```

<br><br>


## Controller
ì „ë‹¬ë˜ì§€ ì•Šì€ íŒŒë¼ë¯¸í„°ëŠ” ìŠ¤í”„ë§ì—ì„œ nullë¡œ ì¸ì§€<br>
=>ê¸°ë³¸íƒ€ì…ì€ nullì´ ë“¤ì–´ê°ˆ ìˆ˜ ì—†ì–´ ì—ëŸ¬ë‚¨<br>
<br>
`@RequestParam` Annotation ì‚¬ìš©<br>

```java
/* í‚¤ê°€ pageNumì¸ ê°’ì„ ë°›ì•„ì™€ int pageNumì— ë„£ìŒ, ë„˜ì–´ì˜¨ ê°’ì´ ì—†ìœ¼ë©´ defaultValueì¸ 1ë¡œ ì§€ì •
ë¬¸ë²•ìƒ "1"ë¡œ í‘œê¸°í–ˆì§€ë§Œ intì„ */

@RequestParam(value = "pageNum", defaultValue = "1") int pageNum
```

<br><br>

```java
// BoardController

@RequestMapping("mainPage")
public String mainPage(
		Model model,
		String searchOption,
		String searchWord, 
		@RequestParam(value = "pageNum", defaultValue = "1") int pageNum) {
	System.out.println("ì‹œìŠ¤í…œ ë¡œê·¸] ë©”ì¸ í˜ì´ì§€ ì‹¤í–‰");
		
	ArrayList<HashMap<String, Object>> dataList = boardService.getBoardList(searchOption, searchWord, pageNum);
		
	int count = boardService.getBoardCount(searchOption, searchWord);
	// 10ë¯¸ë§Œì˜ ê²Œì‹œê¸€ì´ ìˆëŠ” ë§ˆì§€ë§‰ í˜ì´ì§€ ê°œìˆ˜ê¹Œì§€ í¬í•¨í•˜ê¸° ìœ„í•´ ceil(ì˜¬ë¦¼í•¨ìˆ˜) ì‚¬ìš©
	// ì´ í˜ì´ì§€ ìˆ˜
	int totalPageCount  = (int) Math.ceil(count / 10.0);	

	// 1~5, 6~10 ë“±ìœ¼ë¡œ í˜ì´ì§€ëª©ë¡ ë‚˜ëˆ”
	int startPage = ((pageNum-1)/5)*5 + 1;
	int endPage = ((pageNum-1)/5 + 1) * (5);
		
	if(endPage > totalPageCount) {
		endPage = totalPageCount;
	}

	// ë§í¬ì— ê²€ìƒ‰ ê²°ê³¼ íŒŒë¼ë¯¸í„° ì¶”ê°€
	String additionalParam = "";

	// URL encoding -> euc-kr í‘œì¤€ ë¬¸ìê°€ ì•„ë‹Œ ê°’ì´ ì¡´ì¬í•  ë•Œ ì²˜ë¦¬
	if(searchOption != null) {
		try {
			searchOption = URLEncoder.encode(searchOption, "utf-8");
		} catch(Exception e) {
			e.printStackTrace();
		}
		additionalParam += "&searchOption=" + searchOption;
	}
	
	if(searchWord != null) {
		try {
			searchWord = URLEncoder.encode(searchWord, "utf-8");
		} catch(Exception e) {
			e.printStackTrace();
		}
		additionalParam += "&searchWord=" + searchWord;
	}		
		
	// model.addAttribute("count", count);	ê¸€ ê°œìˆ˜ ì¶œë ¥í• ê±°ë©´ ì“¸ ê²ƒ
	model.addAttribute("startPage", startPage);
	model.addAttribute("endPage", endPage);
	model.addAttribute("currentPage", pageNum);
	model.addAttribute("totalPageCount", totalPageCount);		
	model.addAttribute("additionalParam", additionalParam);		
	model.addAttribute("dataList", dataList);	
	return "board/mainPage";
}
```

<br>
<br>

## JSP

```jsp
<%-- mainPage.jsp --%>

<ul class="pagination mb-0">
<c:choose>
    <c:when test="${startPage <= 1 }">
        <li class="page-item disabled page-link">&lt;</li>	    	
    </c:when>
    <c:otherwise>
    <li class="page-item">
            <a class="page-link" href="./mainPage?pageNum=${startPage-1 }${additionalParam }">&lt;</a>
    </li>							    	
    </c:otherwise>
</c:choose>
<c:forEach begin="${startPage }" end="${endPage }" var="i">
    <c:choose>
        <c:when test="${currentPage == i }">
            <li class="page-item active">
                <a class="page-link" href="./mainPage?pageNum=${i }${additionalParam }">${i }</a>
                </li>		
        </c:when>
        <c:otherwise>
            <li class="page-item">
                <a class="page-link" href="./mainPage?pageNum=${i }${additionalParam }">${i }</a>
                </li>
        </c:otherwise>
    </c:choose>							   
</c:forEach>
<c:choose>
    <c:when test="${endPage >= totalPageCount }">
        <li class="page-item disabled page-link">&gt;</li>	    	
    </c:when>
    <c:otherwise>
        <li class="page-item">
            <a class="page-link" href="./mainPage?pageNum=${endPage+1 }${additionalParam }">&gt;</a>
        </li>							    	
    </c:otherwise>
</c:choose>
</ul>
```

<br>
<br><br>


# íŒŒì¼ ì—…ë¡œë“œ
---
ì—…ë¡œë“œ íŒŒì¼ ì €ì¥ìš© í´ë” ë§Œë“¤ê¸°(ì„œë²„í´ë”) : C:\uploadfolder<br>



## XML ì„¤ì •
<br>
**server.xml**<br>
í•˜ë‹¨ì— uploadëœ íŒŒì¼ Context path ì¶”ê°€

```xml
<Context docBase="C:\uploadfolder" path="/upload" reloadable="false"/>
```

* path : ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ëŠ” ê²½ë¡œ(ë§í¬)
* docBasc : ì‹¤ì œë¡œ ì ‘ê·¼ë˜ëŠ” ê²½ë¡œ

`localhost:8181/upload/` ë¡œ ìš”ì²­ë“¤ì–´ì˜¤ë©´ C:\uploadfolderë¡œ ì ‘ê·¼<br>
`<img src="/upload/2022/01/19/ì´ë¯¸ì§€ëª….jpg">` ìœ¼ë¡œ ì´ë¯¸ì§€ ë„ì›€<br>
<br>

> resourceë¡œì„œì˜ ì´ë¯¸ì§€ì™€ êµ¬ë³„í•  ê²ƒ(`webapp/resources/img`ì˜ ì´ë¯¸ì§€)

<br>

<br>
**pom.xml**<br>
multipart/form-data ì„ íŒŒì‹±í•  ì„¸íŒ…ì„ í•´ì¤˜ì•¼ í•¨

```xml
<!-- ì—…ë¡œë“œìš© íŒŒì¼ íŒŒì„œ... -->
<dependency>
	<groupId>commons-fileupload</groupId>
	<artifactId>commons-fileupload</artifactId>
	<version>1.3.3</version>
</dependency>	
```

<br>
<br>
**servlet-context.xml**
- bean ë“±ë¡(íŒŒì¼ ë°›ì„ ê°ì²´ í•„ìš”)
- idëŠ” ë¬´ì¡°ê±´ "multipartResolver" ì—¬ì•¼ í•¨
- CommonsMultipartResolver ê°ì²´ëŠ” @Autowired ì—†ì´ ì•Œì•„ì„œ ë™ì‘
- maxUploadSizeëŠ” byte ë‹¨ìœ„(í˜„ì¬ 100MB)

```xml
<!-- íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ ì¶”ê°€ ë¹ˆ -->
<beans:bean id="multipartResolver" 
class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
	<beans:property name="maxUploadSize" value="100000000"></beans:property>
</beans:bean>
```

<br><br>
<br>

## DB
ê²Œì‹œê¸€ê³¼ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ urlì„ ì—°ê²°í•˜ëŠ” table í•„ìš”<br>
<br><br>

**ERD**

<center><img src="https://user-images.githubusercontent.com/57750308/150634615-45d35c7c-ceb5-4ac6-b748-6bc66112cfcf.png"></center>

<br>

```sql
--ê²Œì‹œíŒ ì´ë¯¸ì§€ í…Œì´ë¸”
DROP TABLE FP_BoardImage;
CREATE TABLE FP_BoardImage (
	image_no NUMBER,
	board_no NUMBER,
	image_url VARCHAR2(300),
	image_original_filename VARCHAR2(400)
);

DROP SEQUENCE FP_BoardImage_seq;
CREATE SEQUENCE FP_BoardImage_seq;

--Board í…Œì´ë¸”ì—ë„ ë™ì‹œì— INSERT í•´ì•¼í•˜ë¯€ë¡œ Board seq 	ë°›ì•„ì˜´
SELECT FP_Board_seq.nextval FROM dual;

--context pathëŠ” urlê°’ì— í¬í•¨í•˜ì§€ ì•Šì•˜ìŒ
INSERT INTO FP_BoardImage VALUES(
	FP_BoardImage_seq.nextval,
	3,
	'2022/01/19/306c8ede-f02a-4558-954f-77e107be8d09_1642558957170.jpg',
	'jjang.jpg'
);

--FKì¸ board_noë¡œ SELECT
SELECT * FROM FP_BoardImage
WHERE board_no = 3;
```

<br>
<br>

## VO
FP_BoardImage í…Œì´ë¸”ì˜ ì†ì„±ê³¼ ë™ì¼í•œ í•„ë“œëª…ì„ ê°–ëŠ” VO ìƒì„±
<br><br>

```java
// BoardImaveVO

package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo;

public class BoardImageVO {
	private int image_no;
	private int board_no;
	private String image_url;
	private String image_original_filename;
	
	// ìƒì„±ì ë° getter/setter ì‘ì„±
}
```

<br><br>

## Mapper

```java
// BoardSQLMapper interface

// ë³´ë“œ í…Œì´ë¸” PK ìƒì„±
public int createBoardPK();

// ì´ë¯¸ì§€ í…Œì´ë¸”ì— INSERT
public void insertImage(BoardImageVO vo);

// ì´ë¯¸ì§€ í…Œì´ë¸”ì—ì„œ board_noë¡œ SELECT
public ArrayList<BoardImageVO> getImageListByBoardNo(int boardNo);
```

<br>

```xml
<!-- BoardSQLMapper.xml -->

<!-- ë³´ë“œ í…Œì´ë¸” PK ìƒì„± -->
<select id="createBoardPK" resultType="int">
    SELECT FP_Board_seq.nextval
    FROM dual
</select>

<insert id="insertBoard">
    INSERT INTO FP_Board VALUES (
    #{board_no},		<!-- FP_Board_seq.nextval => #{board_no}ë¡œ ìˆ˜ì • -->
    #{member_no},
    #{board_title},
    #{board_content},
    0,
    SYSDATE
    )
</insert>

<!-- ì´ë¯¸ì§€ í…Œì´ë¸”ì— INSERT -->
<insert id="insertImage">
    INSERT INTO FP_BoardImage VALUES(
        FP_BoardImage_seq.nextval,
        #{board_no},
        #{image_url},
        #{image_original_filename}
    )
</insert>

<!-- board_noë¡œ ì´ë¯¸ì§€í…Œì´ë¸”ì—ì„œ SELECT -->
<select id="getImageListByBoardNo" resultType="com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.BoardImageVO">
    SELECT *
    FROM FP_BoardImage
    WHERE board_no = #{boardNo};
</select>
```

<br><br>

## Service

```java
// BoardService

public void writeContent(BoardVO vo, ArrayList<BoardImageVO> boardImageVOList) {

	int boardNo = boardSQLMapper.createBoardPK();
		
	vo.setBoard_no(boardNo);
	boardSQLMapper.insertBoard(vo);
		
	for(BoardImageVO boardImageVO : boardImageVOList) {
		boardImageVO.setBoard_no(boardNo);
		boardSQLMapper.insertImage(boardImageVO);
	}
}

public HashMap<String, Object> getBoard(int board_no, boolean isEscape) {

	// ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¶€ë¶„ ìƒëµ

	ArrayList<BoardImageVO> boardImageVOList = 
		boardSQLMapper.getImageListByBoardNo(board_no);
		
		
	map.put("memberVO", memberVO);
	map.put("boardVO", boardVO);
	map.put("boardImageVOList", boardImageVOList);
```

<br><br>

## Controller
* ì‚¬ìš©ìë“¤ì´ ì—…ë¡œë“œí•œ íŒŒì¼ì„ uploadfolderì— ì €ì¥
  * ë™ì¼í•œ íŒŒì¼ëª…ì„ ê°€ì§„ íŒŒì¼ì´ ì—…ë¡œë“œë  ìˆ˜ ìˆìŒ
    * uploadfolderì— ë®ì–´ì”Œì›Œì§
  * ì„ì˜ì˜ ëœë¤id + ì‹œê°„ì„ íŒŒì¼ëª…ìœ¼ë¡œ í•˜ì—¬ ì¤‘ë³µë˜ì§€ ì•Šê²Œ ì €ì¥
  * ë‚ ì§œ(ì‹œê°„)ë³„ë¡œ í´ë”ë¥¼ ë§Œë“¤ì–´ ê´€ë¦¬
    * `c:/uploadfolder/2022/01/19/ì„ì˜ íŒŒì¼ëª….jpg`

<br>

```java
// BoardController

@RequestMapping("writeContentProcess")
/* ì—…ë¡œë“œëœ íŒŒì¼ì€ ë°°ì—´(MultipartFile[])ë¡œ ë°›ìŒ
writeContentPage.jsp : <input type="file" accept="image/*" multiple name="uploadFiles"> */
public String writeContentProcess(BoardVO param, MultipartFile[] uploadFiles, HttpSession session) {
    System.out.println("ì‹œìŠ¤í…œ ë¡œê·¸] ê¸€ì“°ê¸° í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰");
    
    ArrayList<BoardImageVO> boardImageVOList = new ArrayList<>();

    String uploadFolder = "C:/uploadfolder/";
    
    // íŒŒì¼ ì—…ë¡œë“œ
    if(uploadFiles != null) {
        for(MultipartFile uploadFile : uploadFiles) {
            // ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ì–´ë„ ê¼­ í•œ ë²ˆì€ ë£¨í•‘ ëŒê¸° ë•Œë¬¸ì— isEmptyë¡œ ì²´í¬
            if(uploadFile.isEmpty()) {
                continue;
            }
            
            // ë‚ ì§œ ë³„ í´ë” ìƒì„± 2022/01/19
            Date today = new Date();
            SimpleDateFormat sdf = new SimpleDateFormat("yyyy/MM/dd/"); 
            String folderPath= sdf.format(today);
            
            // fileë¿ë§Œì´ ì•„ë‹Œ folderê¹Œì§€ ì»¨íŠ¸ë¡¤
            // C:/uploadfolder/2022/01/19/
            File todayFolder = new File(uploadFolder + folderPath);
            
            if(!todayFolder.exists()) {
                // path ìƒìœ„ì—ì„œë¶€í„° ì—†ëŠ” í´ë” ìƒì„±
                todayFolder.mkdirs();
            }
            
            // ì¤‘ë³µë˜ì§€ ì•Šê²Œ ì €ì¥í•´ì•¼ í•¨(ë®ì–´ì”€ ë°©ì§€)
            // ë°©ë²• : ëœë¤  + ì‹œê°„
            String fileName = "";
            
            // universally unique identifier
            UUID uuid = UUID.randomUUID();				
            fileName += uuid.toString();
            
            long currentTime = System.currentTimeMillis();
            fileName += "_" + currentTime;
            
            // í™•ì¥ì ì¶”ê°€
            // getOriginalFilename : ì—…ë¡œë“œí•œ ìª½ì—ì„œ ì„¤ì •í•œ íŒŒì¼ëª…				
            String originalFileName = uploadFile.getOriginalFilename();
            String ext = originalFileName.substring(
                    originalFileName.lastIndexOf("."));
            fileName += ext;
            
            try {
                // transferTo(File dest) : destë¡œ íŒŒì¼ì„ receive
                uploadFile.transferTo(new File(uploadFolder +
                        folderPath + fileName));
            } catch (Exception e) {
                e.printStackTrace();
            }

            // ì„œë¹„ìŠ¤ì— ë³´ë‚´ê¸° ìœ„í•œ ë°ì´í„° êµ¬ì„±
            BoardImageVO boardImageVO = new BoardImageVO();
            boardImageVO.setImage_url(folderPath + fileName);
            boardImageVO.setImage_original_filename(originalFileName);
            
            boardImageVOList.add(boardImageVO);
        }
    }
    MemberVO sessionUser = (MemberVO) session.getAttribute("sessionUser");
    int memberNo = sessionUser.getMember_no();
    param.setMember_no(memberNo);
    
    // Service(class) -> Mapper(interface, XML) -> INSERT
    boardService.writeContent(param, boardImageVOList);
    
    return "redirect:./mainPage";
}
```

=> `MultipartFile[]`ì—ëŠ” ì´ë¯¸ì§€ê°€ ì›ë³¸ì´ë¯¸ì§€ íŒŒì¼ ì´ë¦„ìˆœìœ¼ë¡œ ë“¤ì–´ê°€ ìˆìŒ(ì˜¤ë¦„ì°¨ìˆœ)<br>
=> FP_BoardImage í…Œì´ë¸”ì—ë„ ì›ë³¸ì´ë¯¸ì§€ íŒŒì¼ ì´ë¦„ìˆœìœ¼ë¡œ INSERTë¨<br>


<br><br>


## JSP

* `<form>` íƒœê·¸ì— `enctype`(ì¸ì½”ë”©íƒ€ì…) ì„¤ì •
  * defaultëŠ” `application/x-www-form-urlencoded` : url ì¸ì½”ë”© ë°©ì‹`(key=value&key=value)`
  * url ì¸ì½”ë”© ë°©ì‹ìœ¼ë¡œëŠ” íŒŒì¼ì „ì†¡ ì•ˆ ë¨
  * `enctype="multipart/form-data"` ë¡œ ì„¤ì •
* methodëŠ” ë°˜ë“œì‹œ `post`

<br>

```jsp
<%-- writeContentPage.jsp --%>

<%-- accept="image/*" : imageíŒŒì¼ë§Œ ë°›ìŒ, multiple : íŒŒì¼ ì—¬ëŸ¬ê°œ ì„ íƒ ê°€ëŠ¥ --%>

<form action="./writeContentProcess" method="post" enctype="multipart/form-data">
    ì‘ì„±ì : ${sessionUser.member_nick }<br>
    ì œëª© : <input type="text" name="board_title"><br>
    ë‚´ìš© : <br>
    <textarea rows="10" cols="40" name="board_content"></textarea><br>
    <input type="file" accept="image/*" multiple name="uploadFiles"><br>
    <input type="submit" value="ì‘ì„±ì™„ë£Œ">
</form>
```

<br>

```jsp
<%-- readContentPage.jsp --%>

ì´ë¯¸ì§€ : <br>
<c:forEach items="${data.boardImageVOList }" var="boardImageVO">
	<img src="/upload/${boardImageVO.image_url }"><br>
</c:forEach>
```

<br><br>
<br>

# ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
---
ì‚¬ìš©ìë“¤ ëŒ€ë¶€ë¶„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ì´íŠ¸ë§ˆë‹¤ ë™ì¼í•˜ê²Œ ì„¤ì •
* DB íƒˆì·¨ì— ì˜í•œ ìœ ì¶œ ìœ„í—˜
* ì•”í˜¸í™”í•˜ì—¬ DBì— ì €ì¥ í•„ìš”

<br>
ì•”í˜¸
1. ë³µí˜¸í™” ê°€ëŠ¥

2. ë³µí˜¸í™” ë¶ˆê°€ëŠ¥
* ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì„ ì•Œì•„ë„ ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•´ì•¼ í•¨
* Hash ì•Œê³ ë¦¬ì¦˜
  * Hash : ì˜ê²Œ ìª¼ê° ë‹¤
  * `ex)1234 -> f(x) ê° ìë¦¿ ìˆ˜ë¥¼ ì˜ê°œ ìª¼ê°œì„œ ë”í•¨ -> 10`

<br>

* Hash ì•Œê³ ë¦¬ì¦˜ì˜ íŠ¹ì§•
  * ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•´ì•¼ í•œë‹¤
  * y = f(x)ê°€ ì„±ë¦½ë¼ì•¼ í•œë‹¤(ë™ì¼ ì•Œê³ ë¦¬ì¦˜ì•ˆì—ì„œ xëŠ” í•­ìƒ yê°€ ë‚˜ì˜´)
  * ë‹¨ë°©í–¥ì„±(ë³µí˜¸í™” ë¶ˆê°€)
  * ì•”í˜¸í™” ê²°ê³¼ê°€ ê°™ì€ ì¶©ëŒì´ ì´ë¡ ì ìœ¼ë¡œ ì¡´ì¬

<br>
â“ í•´ì‹œíƒœê·¸<br>
íƒœê·¸ ë‚´ìš©ì„ í•´ì‹±í•˜ì—¬ ìˆ«ìë¡œ ë§Œë“¤ì–´ ê²€ìƒ‰ ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•¨(ë¬¸ì ë¹„êµëŠ” ì†ë„ê°€ ëŠë¦¼)
<br>
<br>

* SHA ì‚¬ìš©í•  ê²ƒ
  * SHA-256 -> 256bit, SHA-512 -> 512bit, SHA-1 -> 160bit
  * MessageDigest í´ë˜ìŠ¤ : ë©”ì„¸ì§€ë¥¼ ì••ì¶•, ì–´ë–¤ xë¥¼ ë„£ì–´ë„ N bitì˜ yê°€ ë‚˜ì˜´
  * xëŠ” ë¬´í•œëŒ€, yëŠ” N bit ìë¦¿ìˆ˜ë¡œ í•œì •ë˜ì–´ ìˆìŒ
    * ì¶©ëŒ ë°œìƒ ê°€ëŠ¥ì„±

<br><br>

## Commons

```java
// MessageDigestUtil

package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….commons;

public class MessageDigestUtil {
	// static ëŒ€ì‹  í´ë˜ìŠ¤ ìœ„ì— @Component ë‹¬ê³  @Autowiredí•´ì„œ ì¨ë„ ë¨
	public static String getPasswordHashCode(String password) {

		// salt : ì•”í˜¸ ë’¤ì— ì„ì˜ì˜ ë¬¸ìì—´ì„ ë¶™ì—¬ ì›ë¬¸ ì¶”ì  ì–´ë µê²Œ í•¨
		password = password + "ì†Œê¸ˆí›„ì¶”";		

		String hashCode = null;
		
		// passwordë¥¼ ì•”í˜¸í™” í•œë‹¤
		try {
			
			MessageDigest messageDigest = 
					MessageDigest.getInstance("SHA-1");	// 160bitë¡œ ì•”í˜¸í™”
			messageDigest.reset();
			
			// íŒŒë¼ë¯¸í„°ë¡œ byte íƒ€ì… ë°›ìŒ -> ë¬¸ì ë¿ë§Œì•„ë‹ˆë¼ íŒŒì¼ë„ ì•”í˜¸í™” ê°€ëŠ¥
			messageDigest.update(password.getBytes("UTF-8"));
			
			// 160bit í•´ì‹œ ê°’ ìƒì„±(chars.lengthëŠ” 20)
			byte[] chars = messageDigest.digest();
			
			// ëª¨ì–‘ ì˜ˆì˜ê²Œ ë§Œë“¤ê¸°(í•œ ìë¦¿ìˆ˜ë©´ ì•ì— 0 ë¶™ì´ê¸°)
			StringBuilder sb = new StringBuilder();
			
			for(int i=0;i<chars.length;i++) {
				// int ê°’ì„ ë„£ìœ¼ë©´ ë¬¸ìë¥¼ return
				String tmp = Integer.toHexString(chars[i] & 0xff);
				
				if(tmp.length() == 1) {
					sb.append("0");
				}
				
				sb.append(tmp);
			}
			hashCode = sb.toString();
			
		} catch(Exception e) {
			e.printStackTrace();
		}
		
		return hashCode;
	}
}
```

<br><br>

## Service

```java
// MemberService : 

public void joinMember(MemberVO vo, int[] hobby_category_no) {

	// member_no(PK) ë¨¼ì € ìƒì„±
	int memberNo = memberSQLMapper.createMemberPK();

	// DB insert
	vo.setMember_no(memberNo);

	// ë¹„ë°€ë²ˆí˜¸ í•´ì‹±		
	String password = vo.getMember_pw();
	password = MessageDigestUtil.getPasswordHashCode(password);
	vo.setMember_pw(password);
		
	memberSQLMapper.joinMember(vo);

	// ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¶€ë¶„ ìƒëµ
}


public MemberVO login(MemberVO vo) {
		
	// ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
	String password = vo.getMember_pw();
	password = MessageDigestUtil.getPasswordHashCode(password);
	vo.setMember_pw(password);
	
	MemberVO result = memberSQLMapper.getMemberByIdAndPw(vo);
		
	return result;
}
```

<br><br>
<br>

# ì´ë©”ì¼ ì¸ì¦
---
íšŒì›ê°€ì… ì‹œ ì¸ì¦í‚¤ ìƒì„± í›„ ê¸°ì¬í•œ ì´ë©”ì¼ë¡œ ì¸ì¦ ë©”ì¼ ì „ì†¡<br>
ì‚¬ìš©ìê°€ ë©”ì¼ ë‚´ ì¸ì¦ ë§í¬ë¥¼ í´ë¦­í•´ì•¼ ì¸ì¦ ì™„ë£Œ/ë¡œê·¸ì¸ ê°€ëŠ¥<br>
<br>
<br>


## XML ì„¤ì •
<br>
**pom.xml**

```xml
<!-- Mail ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context-support</artifactId>
    <version>5.0.7.RELEASE</version>
</dependency>

<dependency>
    <groupId>javax.mail</groupId>
    <artifactId>mail</artifactId>
    <version>1.4.7</version>
</dependency>
```

<br>
<br>

**root-context.xml**
* ë©”ì¼ ë³´ë‚´ëŠ” í´ë˜ìŠ¤ bean ë“±ë¡
* property ì„¤ì •ìœ¼ë¡œ setter í˜¸ì¶œí•˜ì—¬ ë³´ë‚´ëŠ” ë©”ì¼ì£¼ì†Œ, pw ì„¸íŒ…

```xml
<!-- ë©”ì¼ ê´€ë ¨ ì¸ìŠ¤í„´ìŠ¤ ì¶”ê°€ -->
<bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
    <property name="host" value="smtp.gmail.com" />
    <property name="port" value="587" />
    <property name="username" value="ë©”ì¼ì£¼ì†Œ@gmail.com" />
    <property name="password" value="ë¹„ë°€ë²ˆí˜¸" />
    <!-- email ìš”ì²­ì‹œëŠ” SMTP -->
    <property name="javaMailProperties">
    <props>
        <prop key="mail.transport.protocol">smtp</prop>
        <prop key="mail.smtp.auth">true</prop>
        <prop key="mail.smtp.starttls.enable">true</prop>
        <prop key="mail.debug">false</prop>
        <prop key="mail.smtp.ssl.trust">smtp.gmail.com</prop>
        <prop key="mail.smtp.ssl.protocols">TLSv1.2</prop>
    </props>
    </property>
</bean>
```

<br><br>



## DB
<br>
**ERD**

<center><img src="https://user-images.githubusercontent.com/57750308/150635728-742e748f-6c4c-4976-914c-f5d24fafcdec.png"></center>

<br>

```sql
--íšŒì› ì´ë©”ì¼ ì¸ì¦ í…Œì´ë¸”
DROP TABLE FP_MailAuth;
CREATE TABLE FP_MailAuth (
	mailauth_no NUMBER,
	member_no NUMBER,
	mailauth_key VARCHAR2(400),
	mailauth_complete VARCHAR2(1),
	mailauth_date DATE
);

DROP SEQUENCE FP_MailAuth_seq;
CREATE SEQUENCE FP_MailAuth_seq;


--TEST
--ê°€ì…ì‹œ ì¸ì¦ ì•ˆ ëœ ìƒíƒœì´ë¯€ë¡œ
--mailauth_complete='N', mailauth_date=NULL
INSERT INTO FP_MailAuth VALUES (
	FP_MailAuth_seq.nextval,
	1,
	'í‚¤ ë²ˆí˜¸....',
	'N',
	NULL
);

--í‚¤ ë²ˆí˜¸ë¡œ ì¡°ê±´ ê²€ìƒ‰
UPDATE FP_MailAuth
SET mailauth_complete = 'Y', mailauth_date = SYSDATE
WHERE mailauth_key = 'í‚¤ ë²ˆí˜¸....';

SELECT * FROM FP_MailAuth;


--ë¡œê·¸ì¸ ì¿¼ë¦¬
SELECT * FROM FP_Member fmb, FP_MailAuth fma
WHERE fmb.member_no = fma.member_no
AND fmb.member_id = ì•„ì´ë””'
AND fmb.member_pw = 'í•´ì‰¬ ê°’'
AND fma.mailauth_complete = 'Y';
```

<br><br>

## Mapper

```java
// MemberSQLMapper interface

// ë©”ì¼ ì¸ì¦ ê´€ë ¨
public void insertMailAuth(MailAuthVO vo);
public void updateMailAuthComplete(String authKey);
```

<br>

```xml
<!-- MemberSQLMapper.xml -->

<insert id="insertMatilAuth">
	INSERT INTO FP_MailAuth VALUES (
	FP_MailAuth_seq.nextval,
	#{member_no},
	#{mailauth_key},
	'N',
	NULL
)		
</insert>	

<!-- ë©”ì¼ ì¸ì¦ ì™„ë£Œ -->
<update id="updateMailAuthComplete">
	UPDATE FP_MailAuth
	SET mailauth_complete = 'Y', mailauth_date = SYSDATE
	WHERE mailauth_key = #{authKey}
</update>

<!-- ë¡œê·¸ì¸ ì‹œ ì¸ì¦ ì—¬ë¶€ í™•ì¸ -->
<select id="getMemberByIdAndPw" resultType="com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.MemberVO">
	SELECT * FROM FP_Member fmb, FP_MailAuth fma
	WHERE fmb.member_no = fma.member_no
	AND fmb.member_id = #{member_id}
	AND fmb.member_pw = #{member_pw}
	AND fma.mailauth_complete = 'Y'
</select>
```

<br><br>


## Commons
ë©”ì¼ì„ ë°œì†¡í•˜ëŠ” JavaMailSenderì˜ send() ë©”ì†Œë“œ í˜¸ì¶œì‹œ ë”œë ˆì´ ì¡´ì¬<br>
=> ë©”ì¼ë³´ë‚´ëŠ” ë¶€ë¶„ ì“°ë ˆë“œë¡œ ì²˜ë¦¬<br>

```java
// MailSenderThread

package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….commons;

import javax.mail.internet.MimeMessage;

import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;

public class MailSenderThread extends Thread {
	
	private JavaMailSender javaMailSender;
	private String to;
	private String message;
	
	public MailSenderThread(JavaMailSender javaMailSender,	String to, String message) {
		this.javaMailSender = javaMailSender;
		this.to = to;
		this.message = message;
	}
	
	public void run() {
		// ì¸ì¦í‚¤ë¥¼ ë©”ì¼ë¡œ ì „ì†¡
		try {
			MimeMessage mimeMessage = javaMailSender.createMimeMessage();
			// wrapper í´ë˜ìŠ¤(MimeMessageë¥¼ wrapping)
			MimeMessageHelper mimeMessageHelper = 
					new MimeMessageHelper(mimeMessage, true, "UTF-8");
			
			mimeMessageHelper.setSubject("íšŒì›ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤.");
			mimeMessageHelper.setText(message, true);
			
			// setFrom ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” ê¼­ ì˜ì–´ë¡œ í•´ì•¼ í•¨(í•œê¸€X)
			mimeMessageHelper.setFrom("qwer", "FP ê´€ë¦¬ì");	// ë³´ë‚´ëŠ” ì‚¬ëŒ: FP ê´€ë¦¬ì
			mimeMessageHelper.setTo(to);
			
			javaMailSender.send(mimeMessage);
		} catch(Exception e) {
			e.printStackTrace();
		}
	}
}
```

<br>
<br>


## Service
íšŒì›ê°€ì…í•˜ë©´ 3ê°œ í…Œì´ë¸”ì— INSERTë¨(FP_Member, FP_MemberHobby, FP_MailAuth)

```java
// MemberService

public void joinMember(MemberVO vo, int[] hobby_category_no) {

    // ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¶€ë¶„ ìƒëµ

    // ë©”ì¼ ì¸ì¦ ê´€ë ¨
    // UUIDë„ íŠ¹ì • ê¸¸ì´ ë¬¸ì ë°˜í™˜ì„ í•´ì„œ ì¶©ëŒ ìœ„í—˜ì€ ìˆìŒ
    UUID uuid = UUID.randomUUID();
    String authKey = uuid.toString();
    
    MailAuthVO mailAuthVO = new MailAuthVO();
    mailAuthVO.setMailauth_key(authKey);
    mailAuthVO.setMember_no(memberNo);
    
    memberSQLMapper.insertMailAuth(mailAuthVO);
    
    
    // ì¸ì¦í‚¤ë¥¼ ë©”ì¼ë¡œ ì „ì†¡
    String text= "";
    text += "íšŒì›ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. ì•„ë˜ ë§í¬ë¥¼ í´ë¦­í•˜ì…”ì„œ ë©”ì¼ ì¸ì¦ ì™„ë£Œë¥¼ ë¶€íƒë“œë¦½ë‹ˆë‹¤.<br>";
    text += "<a href='http://localhost:8181/í”„ë¡œì íŠ¸ëª…/member/mailAuthProcess?authKey=" + authKey + "'>ë©”ì¼ ì¸ì¦í•˜ê¸°</a>";
    
    MailSenderThread mst = new MailSenderThread(
            javaMailSender, vo.getMember_email(), text); 
    
    mst.start();
}

public void authMail(String key) {
	memberSQLMapper.updateMailAuthComplete(key);
}
```

<br><br>

## Controller

```java
// MemberController :

@RequestMapping("mailAuthProcess")
public String mailAuthProcess(String authKey) {		
	memberService.authMail(authKey);

	return "member/authMailProcessComplete";
}
```

<br><br>

## JSP


```jsp
<%-- joinMemberComplete.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	íšŒì›ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤.<br>
	ê°€ì…í•˜ì‹  ì´ë©”ì¼ë¡œ ì¸ì¦ ë©”ì¼ì„ ì „ì†¡í•˜ì˜€ìŠµë‹ˆë‹¤.<br>
	ë©”ì¼ í™•ì¸ í›„ ë§í¬ë¥¼ í´ë¦­í•˜ì…”ì„œ ì¸ì¦ í›„ ì´ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
	ë©”ì¼ ì „ì†¡ì€ 3~5ë¶„ ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
	<a href="./loginPage">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</a> 
</body>
</html>
```

<br>

```jsp
<%-- authMailProcessComplete.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
	ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥ í•©ë‹ˆë‹¤.<br>
	<a href="./loginPage">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</a>
</body>
</html>
```

<br>

```jsp
<%-- loginFail.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	ì•„ì´ë”” í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. í˜¹ì€ ë©”ì¼ì¸ì¦ í™•ì¸í•´ ì£¼ì„¸ìš”.<br>
	<a href="./loginPage">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</a>
</body>
</html>
```

<br><br>
<br>

# ì¢‹ì•„ìš”
---
ê²Œì‹œê¸€ì— í•˜íŠ¸ ì•„ì´ì½˜ì„ ì¶”ê°€í•˜ì—¬ ì¢‹ì•„ìš” ê¸°ëŠ¥ ì‘ì„±<br>
í•œ ë²ˆ ëˆ„ë¥´ë©´ ì¢‹ì•„ìš”, ì¶”ê°€ë¡œ ëˆ„ë¥´ë©´ ì¢‹ì•„ìš” í•´ì œ<br>
<br>
<br>

## DB
ì—°ê²°ì˜ ì˜ë¯¸ê°€ ìˆëŠ” í…Œì´ë¸”(ëˆ„ê°€ ë¬´ì—‡ì„ ì–´ë–»ê²Œ í–ˆë‹¤)<br>
ìƒí’ˆ êµ¬ë§¤, ì¥ë°”êµ¬ë‹ˆ, ì°œí•˜ê¸°, ìŠ¤í¬ë©, ì¹œêµ¬ì¶”ê°€ ë“±ê³¼ ë¹„ìŠ·í•œ êµ¬ì¡°ì˜ í…Œì´ë¸”<br>
<br><br>

**ERD**

<center><img src="https://user-images.githubusercontent.com/57750308/150636587-2233e74d-3da4-48ba-b12f-7282a583d08b.png"></center>

<br>

```sql
--ì¢‹ì•„ìš” í…Œì´ë¸”
--member_no, board_noëŠ” FK
DROP TABLE FP_BoardLike;
CREATE TABLE FP_BoardLike (
	like_no NUMBER,
	member_no NUMBER,
	board_no NUMBER,
	like_date DATE
);


DROP SEQUENCE FP_BoardLike_seq;
CREATE SEQUENCE FP_BoardLike_seq;


--í…ŒìŠ¤íŠ¸
--ì¢‹ì•„ìš”í–ˆì„ ë•Œ INSERT
INSERT INTO FP_BoardLike VALUES (
	FP_BoardLike_seq.nextval,
	1,
	1,
	SYSDATE
)

--ì¢‹ì•„ìš” ì·¨ì†Œ
DELETE FROM FP_BoardLike 
WHERE member_no = 1
AND board_no = 1;

--íŠ¹ì • ê²Œì‹œê¸€ì˜ ì´ ì¢‹ì•„ìš” ìˆ˜
SELECT COUNT(*)
FROM FP_BoardLike 
WHERE board_no = 1;

--1ë²ˆíšŒì›ì´ 1ë²ˆ ê¸€ì— ì¢‹ì•„ìš”ë¥¼ í–ˆëŠ”ì§€ ì¡°íšŒ
--ì •ìƒì ì¸ ê²½ìš° : 0 or 1
--ë¹„ì •ìƒì ì¸ ê²½ìš° : 2 ì´ìƒ(ë²„ê·¸ê°€ ìƒê²¨ì„œ ë‘ ë²ˆ ì´ìƒ INSERT ë¨)
SELECT COUNT(*)
FROM FP_BoardLike 
WHERE member_no = 1
AND board_no = 1;
```

<br><br>

## VO
FP_BoardLike í…Œì´ë¸”ê³¼ ë™ì¼í•œ ì†ì„±ì„ ê°–ëŠ” VO ì‘ì„±


```java
public class BoardLikeVO {
	private int like_no;
	private int member_no;
	private int board_no;
	private Date like_date;

	// ìƒì„±ì ë° getter/setter ì‘ì„±
}
```

<br><br>

## Mapper

```java
// BoardSQLMapper interface

// ì¢‹ì•„ìš” í…Œì´ë¸”
public void insertLike(BoardLikeVO vo);
public void deleteLike(BoardLikeVO vo);
public int getTotalLikeCount(int board_no);
public int getMyLikeCount(BoardLikeVO vo);
```

<br>

```xml
<!-- BoardSQLMapper.xml -->

<!-- ì¢‹ì•„ìš” í…Œì´ë¸” -->
<insert id="insertLike">
    INSERT INTO FP_BoardLike VALUES (
    FP_BoardLike_seq.nextval,
    #{member_no},
    #{board_no},
    SYSDATE
    )	
</insert>

<delete id="deleteLike">
    DELETE FROM FP_BoardLike 
    WHERE member_no = #{member_no}
    AND board_no = #{board_no}	
</delete>

<select id="getTotalLikeCount" resultType="int">
    SELECT COUNT(*)
    FROM FP_BoardLike 
    WHERE board_no = #{board_no}	
</select>

<select id="getMyLikeCount" resultType="int">
    SELECT COUNT(*)
    FROM FP_BoardLike
    WHERE member_no = #{member_no}
    AND board_no = #{board_no}
</select>
```

<br><br>

## Service
ì¢‹ì•„ìš”ì™€ ì¢‹ì•„ìš” ì·¨ì†Œ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¡œ ì‘ì„±
<br><br>

```java
// BoardService

// ì¢‹ì•„ìš” or ì¢‹ì•„ìš” ì·¨ì†Œ
public void doLike(BoardLikeVO vo) {
	int count = boardSQLMapper.getMyLikeCount(vo);
	
	if(count > 0) {
		boardSQLMapper.deleteLike(vo);
	} else {
		boardSQLMapper.insertLike(vo);
	}
}

// ê²Œì‹œê¸€ì˜ ì´ ì¢‹ì•„ìš” ê°œìˆ˜ í‘œì‹œ
public int getTotalLikeCount(int boardNo) {
		
	return boardSQLMapper.getTotalLikeCount(boardNo);
}

// ì‚¬ìš©ìì˜ íŠ¹ì • ê²Œì‹œê¸€ì˜ ì¢‹ì•„ìš” ì¹´ìš´íŠ¸	
public int getMyLikeCount(BoardLikeVO vo) {
	return boardSQLMapper.getMyLikeCount(vo);
}
```

<br>
<br>

## Controller

```java
// BoardController

@RequestMapping("likeProcess")
public String likeProcess(BoardLikeVO param, HttpSession session) {
	// í–‰ìœ„ì ì •ë³´ëŠ” ê¼­ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¬ ê²ƒ
	MemberVO sessionUser = (MemberVO) session.getAttribute("sessionUser");
	int memberNo = sessionUser.getMember_no();
	param.setMember_no(memberNo);
		
	boardService.doLike(param);
		
	return "redirect:./readContentPage?board_no=" + param.getBoard_no();
}

@RequestMapping("readContentPage")
public String readContentPage(int board_no, Model model, HttpSession session) {
    boardService.increaseReadCount(board_no);
    
    HashMap<String, Object> map = boardService.getBoard(board_no, true);
    
    model.addAttribute("data", map);
    
    // ê²Œì‹œê¸€ì˜ ì´ ì¢‹ì•„ìš” ìˆ˜
    int totalLikeCount = boardService.getTotalLikeCount(board_no);
    model.addAttribute("totalLikeCount", totalLikeCount);
    
    // ë¡œê·¸ì¸ì¸í•œ íšŒì›ì˜ ì¢‹ì•„ìš” ì—¬ë¶€ í™•ì¸
    MemberVO sessionUser = (MemberVO) session.getAttribute("sessionUser");
    if(sessionUser != null) {
        BoardLikeVO boardLikeVO = new BoardLikeVO();
        boardLikeVO.setMember_no(sessionUser.getMember_no());
        boardLikeVO.setBoard_no(board_no);
        
        int myLikeCount = boardService.getMyLikeCount(boardLikeVO);
        
        model.addAttribute("myLikeCount", myLikeCount);
    } 
    return "board/readContentPage";
}
```

<br><br>

## JSP
bootstrapì˜ í•˜íŠ¸ ì•„ì´ì½˜ ì‚¬ìš©

```jsp
<%-- readContentPage.jsp --%>

<%-- ê¸°ì¡´ê³¼ ë™ì¼í•œ ë‚´ìš© ìƒëµ --%>

<c:if test="${!empty sessionUser }">
    <c:choose>
        <c:when test="${myLikeCount > 0 }">	<%-- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° ìƒ‰ì´ ì±„ì›Œì§„ í•˜íŠ¸ --%>
            <a href="./likeProcess?board_no=${data.boardVO.board_no }"><i class="bi bi-heart-fill fs-1 text-danger"></i></a>		
        </c:when>
        <c:otherwise>	<%-- ì¢‹ì•„ìš”ë¥¼ í•´ì œí•œ ê²½ìš° ìƒ‰ì´ ë¹ˆ í•˜íŠ¸ --%>
            <a href="./likeProcess?board_no=${data.boardVO.board_no }"><i class="bi bi-heart fs-1 text-danger"></i></a>	
        </c:otherwise>
    </c:choose>
<br>

</c:if>
ì¢‹ì•„ìš” ìˆ˜ : ${totalLikeCount }
```

<br>
<br><br>

# Interceptor(ì¸í„°ì…‰í„°)
---
ìµœí›„ì— ì‘ì—…í•´ì•¼í•˜ëŠ” ë‚´ìš©<br>
íŠ¹ì • ìš”ì²­ì„ ì¤‘ê°„ì—ì„œ ê°€ë¡œì±„ ì‘ì—… í›„ ëª©ì ì§€ë¡œ ë³´ë‚´ë˜ê°€ ëŒë ¤ë³´ëƒ„<br>
<br>

`ex)ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ê¸€ì“°ê¸°/ìˆ˜ì • í˜ì´ì§€ì— ë§í¬ë¡œ ì ‘ê·¼`<br>
`=> ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì¼ì¼ì´ sessionì— ì ‘ì†ì •ë³´ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•¨`<br>
`=> ì¤‘ê°„ì— ì¸í„°ì…‰í„°ë¥¼ ë‘¬ ì¸í„°ì…‰í„°ì—ì„œë§Œ ë¡œê·¸ì¸ì—¬ë¶€ í™•ì¸(í†°ìº£ì˜ filterì™€ ë¹„ìŠ·)`<br>

<br>
<br>

## XML ì„¤ì •
**servlet-context.xml**
* `/board/*`ë¡œ ë§µí•‘í•˜ì—¬ `/board/~~`ëŠ” ì „ë¶€ ì¸í„°ì…‰í„°ê°€ ê°€ë¡œì±”
* ë‹¤ë§Œ, ë¡œê·¸ì¸ì´ ì—†ì–´ë„ ì‚¬ìš©ê°€ëŠ¥í•œ `/board/mainPage, /board/readContentPage`ëŠ” ì œì™¸

```xml
<!-- ì¸í„°ì…‰í„° ì„¤ì • -->
<interceptors>
    <interceptor>
        <mapping path="/board/*"/>
        <exclude-mapping path="/board/mainPage"/>
        <exclude-mapping path="/board/readContentPage"/>
        <beans:bean class="com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….interceptor.AuthInterceptor"></beans:bean>
    </interceptor>
</interceptors>
```

<br>
<br>

## Interceptor

```java
// AuthInterceptor

package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….interceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.ModelAndViewDefiningException;
import org.springframework.web.servlet.mvc.WebContentInterceptor;

public class AuthInterceptor extends WebContentInterceptor{
	// ì˜¤ë²„ë¼ì´ë”©
	public boolean preHandle(
			HttpServletRequest request, 
			HttpServletResponse response, 
			Object handler) throws ModelAndViewDefiningException {

		// ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì„ì„ ì•Œë¦¼
		
		// request.getSession() => return HttpSession ì¸ìŠ¤í„´ìŠ¤
		if(request.getSession().getAttribute("sessionUser") == null) {
			ModelAndView mv = new ModelAndView();
			mv.setViewName("member/loginRequired");	// forwardingí•  ê³³ ì§€ì •
			
			// exceptionì„ ë°œìƒì‹œì¼œ forwardingí•¨
			throw new ModelAndViewDefiningException(mv);
		}
		return true;	// ì›ë˜ ëª©ì ì§€ë¡œ ê°
	}
}
```

<br><br>

## JSP

```jsp
<%-- loginRequired.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	ë¡œê·¸ì¸í•˜ì…”ì•¼ ì ‘ê·¼ ê°€ëŠ¥í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.<br>
	<a href="../member/loginPage">ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ</a>
</body>
</html>
```

<br><br>

# ìœ íš¨ì„± ê²€ì‚¬(JavaScript)
---
jspì—ì„œ `null`ê°’ì„ submití•˜ë©´ `NullPointerException` ë°œìƒ<br>
ë²„íŠ¼ì„ ì´ìš©í•˜ì—¬ JavaScriptì—ì„œ `null`ê°’ì´ ë‹´ê¸´ íŒŒë¼ë¯¸í„° ë„˜ì–´ê°€ì§€ ì•Šë„ë¡ ë°©ì§€<br>
<br>
<br>
**JavaScript**
* ì‘ë‹µë°›ì€ HTMLì†ŒìŠ¤(JS í¬í•¨)ë¥¼ ì›¹ë¸Œë¼ìš°ì €ê°€ í•´ì„í•˜ì—¬ í™”ë©´ì— ê·¸ë¦¼
* JavaScriptëŠ” clientê°€ ì‹¤í–‰

<br><br>

## JSP

```jsp
<%-- joinMemberPage.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script>
	// jQuery version
	function joinMemberSubmit1() {	
		// ìœ íš¨ì„± ê²€ì‚¬(ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì´ ì •ìƒì ì¸ ê°’ì¸ì§€ íŒë‹¨)
		// ì •ê·œí‘œí˜„ì‹ ì‚¬ìš©
		// ì˜ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ì—¬ ì˜ì†Œë¬¸ì ë° ìˆ«ìë¡œ ì´ë£¨ì–´ì§„ 6~20ê°œ ì‚¬ì´ì˜ ë¬¸ì
		var regExp = /^[a-z][a-z0-9]{5,19}$/g;
		
		// ìœ„ ì •ê·œí‘œí˜„ì‹ì— ë¶€í•©í•˜ëŠ”ì§€ true/false ë¦¬í„´
		//regExp.test(text);
		
		if(!regExp.test($("#inputId").val())) {
			alert("ì•„ì´ë””ëŠ” ì˜ì†Œë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” ì´ 6ì ~ 20ì ì‚¬ì´ì˜ ì˜ì†Œë¬¸ì/ìˆ«ì ì¡°í•©ìœ¼ë¡œ ì‘ì„±í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.");
			$("#inputId").focus();
			return;
		}
		
		
		//var regExp = /^(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,12}$/;

		// ì•„ë˜ì²˜ëŸ¼ RegExp ê°ì²´ ìƒì„±í•´ì„œ í•´ë„ ë¨(ìƒì„±ìë¡œ ì •ê·œì‹ë“¤ì–´ê°)
		var regExp = RegExp(/^(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,12}$/);
		
		if(!regExp.test($("#inputPw").val())) {
			alert("ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ì†Œë¬¸ì/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ëŠ” ìµœì†Œ 8ì ìµœëŒ€ 12ìì—¬ì•¼ í•©ë‹ˆë‹¤..");
			inputPw.focus();
			return;			
		}

		
		if($("#inputPw").val() != $("#inputPwConfirm").val()) {
			alert("ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");

			$("#inputPw").val("");
			$("#inputPwConfirm").val("");
			$("#inputPw").focus();
			
			return;
		}
		
		if($("#inputBirth").val() == "") {
			alert("ìƒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.")
			$("#inputBirth").focus();
		
			return;
		}
		
		$("#frm1").submit();
	}
	
	// vanilla JS version
	function joinMemberSubmit2() {
		var inputId = document.getElementById("inputId");
		var inputPw = document.getElementById("inputPw");
		var inputPwConfirm = document.getElementById("inputPwConfirm");
		
		var regExp = /^[a-z][a-z0-9]{5,19}$/g;

		if(!regExp.test(inputId.value)) {
			alert("ì•„ì´ë”” í™•ì¸ ìš”ë§");
			inputId.focus();
			return;
		}

		if(inputPw.value != inputPwConfirm.value) {
			alert("ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");

			inputPw.value = "";
			inputPwConfirm.value = "";

			inputPw.focus();
			return;
		}
		
		var frm1 = document.getElementById("frm1");
		frm1.submit();
	}

</script>
</head>
<body>
	<h1>íšŒì›ê°€ì…</h1>
	<form id="frm1" action="./joinMemberProcess" method="post">
		ID : <input id="inputId" type="text" name="member_id"><br>
		PW : <input id="inputPw" type="password" name="member_pw"><br>
		PW Confirm : <input id="inputPwConfirm" type="password"><br>
		
		Nickname : <input id="inputNick" type="text" name="member_nick"><br>
		gender :
		<!-- ì²´í¬, ë¼ë””ì˜¤, ì…€ë ‰íŠ¸ëŠ” valueê°’ì„ ë¯¸ë¦¬ ì§€ì •í•´ì•¼í•¨ -->
		<input type="radio" name="member_gender" value="M" checked> ë‚¨
		<input type="radio" name="member_gender" value="F"> ì—¬<br>
		
		ì·¨ë¯¸ :
		<c:forEach items="${hobbyCategoryList }" var="hobbyCategory">
			<input type="checkbox" name="hobby_category_no" value="${hobbyCategory.hobby_category_no }">${hobbyCategory.hobby_category_name }
		</c:forEach>
		<br>
		
		birth : <input id="inputBirth" type="date" name="member_birth"><br>
		phone : <input id="inputPhone" type="text" name="member_phone"><br>
		e-mail : <input id="inputEmail" type="text" name="member_email"><br>
		<input type="button" value="íšŒì›ê°€ì…" onclick="joinMemberSubmit1()">
	</form>
</body>
</html>
```





<br>
<br><br>


