---
title: "16ì£¼ì°¨ ê²Œì‹œíŒ ë§Œë“¤ê¸° 3ë‹¨ê³„"
excerpt: "2022-02-07 ~ 2022-02-11"

toc: true
toc_sticky: true
categories:
  - Study
---
<br>
# Ajax
---
Asynchronous JavaScript and XML : **ë¹„ë™ê¸°**ì  ì •ë³´ êµí™˜ ê¸°ë²•<br>
í˜¸ì¶œì€ ìˆœì„œëŒ€ë¡œ ë˜ì§€ë§Œ ì‘ë‹µ ì‹œê°„ì€ ìˆœì„œëŒ€ë¡œê°€ ì•„ë‹˜<br>
<br>
<br>
í˜ì´ì§€ê°€ ë„˜ì–´ê°€ì„œ refresh(ë§í¬ ì´ë™)ë˜ì§€ ì•Šê³  í˜„ì¬ í˜ì´ì§€ì—ì„œ ë¡œì§ ì²˜ë¦¬<br>
**ë¶€ë¶„ì  ë¡œë”©**, í˜ì´ì§€(ë§í¬) ì´ë™í•˜ì§€ ì•Šê³  ë‚´ë¶€ì—ì„œ ì²˜ë¦¬<br>
<br>
controllerë¥¼ restAPIë¡œ ë³€ê²½í•´ì£¼ì–´ì•¼ í•¨<br>
ëŒ€í‘œ ìƒíƒœ ì „ì†¡, restAPI í˜¸ì¶œí–ˆì„ ë•Œ **ìƒíƒœ(data)ë¥¼ ì‘ë‹µ**<br>
<br>
ê¸°ì¡´ : serverìª½ì—ì„œ html ì½”ë“œë¥¼ ë§Œë“¦(SSR : server side rendering), ì²˜ìŒë¶€í„° ëê¹Œì§€ ë Œë”ë§<br>
Ajax ì‚¬ìš© : serverì— ìˆëŠ” restAPI í˜¸ì¶œí•˜ì—¬ returnë°›ì€ ê²°ê³¼ë¡œ **Client Side Rendering**<br>
<br>
<br>

## restAPI ë§Œë“¤ê¸°
1.pom.xmlì— dependency ì¶”ê°€
- javaìª½ì˜ HashMapì„ **json í˜•íƒœì˜ ë¬¸ìì—´**ë¡œ ì¸ì½”ë”©

```xml
<dependency>
	<groupId>com.fasterxml.jackson.core</groupId>
	<artifactId>jackson-databind</artifactId>
	<version>2.9.5</version>
</dependency>	
```

<br>

2.controller í´ë˜ìŠ¤ëª… ìœ„ì— `@RestController` ì–´ë…¸í…Œì´ì…˜
- `@RestController` ì–´ë…¸í…Œì´ì…˜ì€ ì•„ë˜ ë‘ ì–´ë…¸í…Œì´ì…˜ì„ í•©ì¹œ ê²ƒ
  - methodëª… ìœ„ì— `@ResponseBody` ì–´ë…¸í…Œì´ì…˜
  - classëª… ìœ„ì— `@Controller`


```java
@RestController
@RequestMapping("/test/*")
public class RestController {

	...

}
```

<br>

3.controller methodì˜ return type `HashMap<String, Object>`ë¡œ ì„¤ì •
-  ë”ì´ìƒ jspë¡œ forwardingí•˜ì§€ ì•Šê³  **jsoní˜•íƒœë¡œ return(dataë¥¼ return)**

```java
@RequestMapping("test1")
public HashMap<String, Object> test1() {
	
	HashMap<String, Object> data = new HashMap<>();

	data.put("a", 10);
	data.put("b", 20);
	data.put("c", 30);

	int[] arr = {1, 2, 3, 4, 5}'
	data.put("d", arr);

	return data;
}
```

ê²°ê³¼) {"a":10,"b":20,"c":30,"d":[1,2,3,4,5]}

<br><br>
jsonì— í´ë˜ìŠ¤ê°€ ë“¤ì–´ìˆì„ ê²½ìš° : {"í‚¤" : {"í•„ë“œ":ê°’, "í•„ë“œ":ê°’, "í•„ë“œ":ê°’, ...}}

```java
@RequestMapping("test5")
public HashMap<String, Object> test5() {
	HashMap<String, Object> data = new HashMap<>();
	
	MemberVO vo1 = new MemberVO();
	vo1.setMember_id("m001");
	MemberVO vo2 = new MemberVO();
	vo2.setMember_id("m002");
		
	data.put("member1", vo1);
	data.put("member2", vo2);
		
	return data;
}
```

ê²°ê³¼)
{"member2":
{"member_no":0,"member_id":"m002","member_pw":null,"member_nick":null,"member_gender":null,"member_birth":null,
"member_phone":null,"member_email":null,"member_joindate":null},
"member1":
{"member_no":0,"member_id":"m001","member_pw":null,"member_nick":null,"member_gender":null,"member_birth":null,
"member_phone":null,"member_email":null,"member_joindate":null}}

<br>
<br><br>

## Ajax í˜¸ì¶œ

javascriptì—ì„œ í˜¸ì¶œ

```jsp
<script>
    /* ê¸°ë³¸ ì–‘ì‹ */

    // ajax í˜¸ì¶œ(vanilla js)
    var xhr = new XMLHttpRequest();	// js ë‚´ì¥ API
    
    // ì‘ë‹µë°›ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” function ì„¤ì •(í•¨ìˆ˜ë¥¼ ë³€ìˆ˜ì— ë‹´ìŒ, ì½œë°±í•¨ìˆ˜)
    // ì´ 4ë²ˆ í˜¸ì¶œ : open, send, serverì— ë„ë‹¬í–ˆì„ ë•Œ, serverë¡œë¶€í„° ì‘ë‹µë°›ì„ ë•Œ
    xhr.onreadystatechange = function() {

        // ì•„ë˜ëŠ” serverë¡œë¶€í„° ì‘ë‹µë°›ì„ ë•Œë§Œ ì‹¤í–‰ë˜ë„ë¡ ì¡°ê±´ ì„¤ì •
        // 200 : ì„œë²„ìª½ ì •ìƒ ì‘ë‹µ(400, 500ì€ ì—ëŸ¬)
        if(xhr.readyState == 4 && xhr.status == 200) {
            
            // JSON í˜•íƒœ ë¬¸ìì—´ì„ js objectë¡œ decoding
            var data = JSON.parse(xhr.responseText);

	// ë™ì‘ ì„¤ì •
        }
    };
    
    // GET ë°©ì‹ì¼ ë•ŒëŠ” dst linkì— íŒŒë¼ë¯¸í„° ê¸°ì…í•´ì¤˜ì•¼ í•¨(dst link?param1=hi&param2=bye)
    xhr.open("GET", "dst link", true);	// true : ë¹„ë™ê¸°, false : ë™ê¸°(ì‘ë‹µì´ ëë‚˜ì•¼ ë‹¤ìŒ í˜¸ì¶œ)

    // POST ë°©ì‹ì¼ ë•ŒëŠ” headerì— content-type ì„¤ì •í•´ì•¼ í•¨(defaultëŠ” multipart/form-data)
    //xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");

    // POST ë°©ì‹ì¼ ë•Œ sendì— íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡í•  data ë„£ì–´ì•¼ í•¨
    xhr.send();
</script>
```



<br>
<br><br>


# ì•„ì´ë”” ì¤‘ë³µí™•ì¸
---
íšŒì›ê°€ì… í˜ì´ì§€ì—ì„œ ì•„ì´ë”” ì¤‘ë³µí™•ì¸í•˜ëŠ” ê¸°ëŠ¥ì„ Ajaxë¥¼ ì´ìš©í•˜ì—¬ í˜ì´ì§€ ì´ë™ì—†ì´ ì²˜ë¦¬<br>
<br>
<br>

## Mapper

```java
// memberSQLMapper interface

public int getCountById(String id);
```

<br>
returnë˜ëŠ” COUNTë¡œ ì•„ì´ë”” ì¤‘ë³µì—¬ë¶€ ì²´í¬


```xml
<!-- memberSQLMapper.xml -->

<select id="getCountById" resultType="int">
	SELECT COUNT(*)
	FROM FP_Member
	WHERE member_id = #{id}
</select>
```

<br><br>

## Service

```java
// memberService

public boolean isExistId(String id) {
		
	int count = memberSQLMapper.getCountById(id);
		
	if(count > 0) {
		return true;	// ì¤‘ë³µ
	} else {
		return false;
	}
}
```

<br><br>

## Controller
ì¼ë°˜ì ìœ¼ë¡œ restAPIë§Œ ë‹´ëŠ” controller ë”°ë¡œ ë§Œë“¦
<br><br>

```java
// RestMemberController

package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….member.controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/member/*")
public class RestMemberController {

	@Autowired
	private MemberService memberService;
	
	@RequestMapping("isExistId")
	public HashMap<String, Object> isExistId(String id) {

		HashMap<String, Object> data = new HashMap<>();
		
		boolean result = memberService.isExistId(id);
		data.put("result", result);
		
		return data;
	}
}
```

<br>
<br>

## JSP(Ajax ì‚¬ìš©)
joinMemberPage.jsp

```jsp
ID : <input id="inputId" type="text" name="member_id" onblur="confirmId()">
```

<br><br>

```jsp
<script>
	var isConfirmed = false;

	function confirmId() {
		var idBox = document.getElementById("inputId");
		var idValue = idBox.value;
		
		var xhr = new XMLHttpRequest();	// js ë‚´ì¥ API
		
		xhr.onreadystatechange = function() {

			if(xhr.readyState == 4 && xhr.status == 200) {

				var data = JSON.parse(xhr.responseText);

				var confirmAlertBox = document.getElementById("confirmAlertBox");

				// data["result"]ë„ ê°€ëŠ¥
				if(data.result == true) {
					isConfirmed = false;
					confirmAlertBox.innerText = "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë”” ì…ë‹ˆë‹¤.";
					confirmAlertBox.style.color = "red";				
				} else {
					isConfirmed = true;
					confirmAlertBox.innerText = "ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë”” ì…ë‹ˆë‹¤.";
					confirmAlertBox.style.color = "green";					
				}
			}
		};
		
		xhr.open("GET", "./isExistId?id=" + idValue, true);
		xhr.send();
		
	}


	function joinMemberSubmit1 {

		...
		
		if(isConfirmed == false) {
			alert("ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬ë¥¼ í•´ì•¼ í•©ë‹ˆë‹¤.");
			return;
		}

		$("#frm1").submit();
	}
</script>
```


<br><br>
<br>

# ì¢‹ì•„ìš”
---
ê¸°ì¡´ : linkë¡œ request, redirectí•˜ì—¬ ì „ì²´ ë Œë”ë§<br>
ìˆ˜ì • : Ajaxë¡œ request, returnëœ dataë¡œ **ë¶€ë¶„ì  ë Œë”ë§**<br>
<br>
<br>


## Controller

```java
// RestBoardController

package com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….board.controller;

import java.util.*;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….board.service.BoardService;
import com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.BoardLikeVO;
import com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.CommentVO;
import com.íŒ€ëª….í”„ë¡œì íŠ¸ëª….vo.MemberVO;

@RestController
@RequestMapping("/board/*")
public class RestBoardController {
	
	@Autowired
	private BoardService boardService;
	
	// ì¢‹ì•„ìš” or ì¢‹ì•„ìš” í•´ì œ
	@RequestMapping("doLike")
	public HashMap<String, Object> doLike(BoardLikeVO param, HttpSession session) {
		
		HashMap<String, Object> data = new HashMap<>();
		
		MemberVO sessionUser = (MemberVO) session.getAttribute("sessionUser");
		if(sessionUser == null) {
			data.put("result", "error");
			data.put("reason", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
			
			return data;
		}
		
		int memberNo = sessionUser.getMember_no();
		param.setMember_no(memberNo);
		
		boardService.doLike(param);
		
		data.put("result", "success");
		
		return data;
	}
	
	// ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì—¬ë¶€(viewì—ì„œ í•˜íŠ¸ ì•„ì´ì½˜ fill or empty)
	@RequestMapping("getMyLikeStatus")
	public HashMap<String, Object> getMyLikeStatus(BoardLikeVO param, HttpSession session) {
		HashMap<String, Object> data = new HashMap<>();
		
		MemberVO sessionUser = (MemberVO) session.getAttribute("sessionUser");
		if(sessionUser == null) {
			data.put("result", "error");
			data.put("reason", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
			return data;
		}
		
		param.setMember_no(sessionUser.getMember_no());
		
		int myLikeCount = boardService.getMyLikeCount(param);
		
		data.put("result", "success");
		
		if(myLikeCount > 0) {
			data.put("status", "like");
		} else {
			data.put("status", "unlike");
		}
		
		return data;
	}
	
	// ê²Œì‹œê¸€ì˜ ì´ ì¢‹ì•„ìš” ê°œìˆ˜
	@RequestMapping("getTotalLikeCount")
	public HashMap<String, Object> getTotalLikeCount(int board_no) {
		HashMap<String, Object> data = new HashMap<>();
		
		int totalLikeCount = boardService.getTotalLikeCount(board_no);
		data.put("totalLikeCount", totalLikeCount);
		
		return data;
	}
}
```

<br>

```java
// RestMemberController

	// í˜„ì¬ ë¡œê·¸ì¸í•œ ê³„ì • ì •ë³´ ê°€ì ¸ì˜¤ê¸°
	@RequestMapping("getSessionInfo")
	public HashMap<String, Object> getSessionInfo(HttpSession session) {
		HashMap<String, Object> data = new HashMap<>();
		
		MemberVO sessionUser = (MemberVO) session.getAttribute("sessionUser");
		
		if(sessionUser == null) {
			data.put("result", "empty");
		} else {
			data.put("result", "success");
			data.put("memberNo", sessionUser.getMember_no());
			data.put("memberNick", sessionUser.getMember_nick());
		}
		
		return data;
	}
```


<br>
<br>

## JSP
`<a></a>`íƒœê·¸ ì§€ìš°ê¸°(linkë¡œ í˜¸ì¶œX, ajaxí˜¸ì¶œí•  ê²ƒì´ë¯€ë¡œ)<br>
<br><br>
ğŸ‘‡í˜ì´ì§€ ë¡œë”©ë˜ìë§ˆì Ajax ì‹¤í–‰

* ë‹¨ìˆœ í•¨ìˆ˜ í˜¸ì¶œ
  * **ë¹„ë™ê¸°ì‹**ì´ë¼ ì‹¤í–‰ì‹œì ì— íƒœê·¸ê°€ ìˆì„ ìˆ˜ë„ ì—†ì„ ìˆ˜ë„ ìˆìŒ
  * ì„œë²„ë¡œë¶€í„° data ë°›ì•„ì˜¤ëŠ” ì†ë„ < íƒœê·¸ ìƒê¸°ëŠ” ì†ë„ => ê°€ëŠ¥
  * ì„œë²„ë¡œë¶€í„° data ë°›ì•„ì˜¤ëŠ” ì†ë„ > íƒœê·¸ ìƒê¸°ëŠ” ì†ë„ => ë¶ˆê°€ëŠ¥
* window í´ë˜ìŠ¤ ê°ì²´ ì‚¬ìš©
  * ì›¹ë¸Œë¼ìš°ì €ì—ì„œ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰ë  **ì½œë°±í•¨ìˆ˜** ì§€ì •
    * `window.addEventListener();`

<br>
```jsp
	// DOMContentLoaded : DOM ì»¨í…ì¸ ê°€ ë‹¤ ë¡œë“œëì„ ë•Œ
	window.addEventListener("DOMContentLoaded", function() {

	// ë¬¸ì„œ ë¡œë“œ í›„ ì‹¤í–‰í•  ë™ì‘

	});
```

<br>
<br>

```jsp
<%-- readContentPage.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>    
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<title>Insert title here</title>

<script>
	var sessionInfo = null;
	
	var board_no = ${data.boardVO.board_no };

	function doLike() {
		
		if(sessionInfo == null) {
			var value = confirm("ë¡œê·¸ì¸í•˜ì…”ì•¼ ì´ìš©ê°€ëŠ¥ í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
			
			if(value == true) {
				location.href="../member/loginPage";
			}
			
			return;
		}
		
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				var data = JSON.parse(xhr.responseText);

				refreshHeart();
				refreshTotalCount();
			}
			
		};
		
		xhr.open("post", "./doLike", true);
		xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xhr.send("board_no=" + board_no);
	}
	
	function refreshHeart() {
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				var data = JSON.parse(xhr.responseText);
				if(data.result == 'error') {
					//alert(data.reason);
					return;
				}
				
				var heartBox = document.getElementById("heartBox");
				
				if(data.status == 'like') {
					heartBox.setAttribute("class", "bi bi-heart-fill fs-1 text-danger");
				} else {
					heartBox.setAttribute("class", "bi bi-heart fs-1 text-danger");
				}
			}
			
		};
		
		xhr.open("get", "./getMyLikeStatus?board_no=" + board_no, true);
		xhr.send();
	}
	
	function refreshTotalCount() {
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				var data = JSON.parse(xhr.responseText);
				
				var totalLikeCountBox = document.getElementById("totalLikeCountBox");
				totalLikeCountBox.innerText = data.totalLikeCount;
			}
			
		};
		
		xhr.open("get", "./getTotalLikeCount?board_no=" + board_no, true);
		xhr.send();			
	}
	
	function getSessionInfo() {
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				var data = JSON.parse(xhr.responseText);
				
				if(data.result != 'empty') {
					sessionInfo = {
						memberNo : data.memberNo,
						memberNick : data.memberNick
					};
				}
				
			}
			
		};
		
		xhr.open("get", "../member/getSessionInfo", false);	// false: ë™ê¸°ì‹(ì›¬ë§Œí•˜ë©´ ì“°ì§€ë§ ê²ƒ)
		xhr.send();
	}
	
	window.addEventListener("DOMContentLoaded", function(){
		getSessionInfo();
		refreshTotalCount();
		refreshHeart();
	});


</script>

</head>
<body>
	<h1>${data.boardVO.board_title }</h1>
	
	ì‘ì„±ì : ${data.memberVO.member_nick }<br>
	ì‘ì„±ì¼ : ${data.boardVO.board_writedate }<br>
	ì¡°íšŒìˆ˜ : ${data.boardVO.board_readcount }<br>
	
	ì´ë¯¸ì§€ : <br>
	<c:forEach items="${data.boardImageVOList }" var="boardImageVO">
		<img src="/upload/${boardImageVO.image_url }"><br>
	</c:forEach>
	
	
	ë‚´ìš© :<br>
	${data.boardVO.board_content }<br>
	
	<br>
	<i id="heartBox" class="bi bi-heart fs-1 text-danger" onclick="doLike()"></i>
	<br>
	ì¢‹ì•„ìš” ìˆ˜ : <span id="totalLikeCountBox"></span>
	<br>
	
	<br><a href="./mainPage">ëª©ë¡ìœ¼ë¡œ</a>
	
	<%-- ë¡œê·¸ì¸+ë³¸ì¸ì´ ì“´ ê¸€ì¼ê²½ìš° ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ ë‚˜íƒ€ë‚¨ --%>
	<c:if test="${!empty sessionUser && sessionUser.member_no == data.boardVO.member_no }">
	<a href="./deleteContentProcess?board_no=${data.boardVO.board_no }">ì‚­ì œ</a>
	<a href="./updateContentPage?board_no=${data.boardVO.board_no }">ìˆ˜ì •</a>
	</c:if>
	
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>	
</body>
</html>
```


<br>
<br><br>


# ëŒ“ê¸€
---

## ERD

<center><img src="https://user-images.githubusercontent.com/57750308/153701065-3b62ec24-bd9e-4fe2-b672-d0026d5b9d6c.png"></center>

<br><br>

## Mapper

```java
// boardSQLMapper interface

public interface BoardSQLMapper {

	...

	// ì½”ë©˜íŠ¸ í…Œì´ë¸”
	public void insertComment(CommentVO vo);
	public ArrayList<HashMap<String, Object>> getCommentListByBoardNo(int boardNo);
	public void deleteComment(int commentNo);
	public void updateComment(CommentVO vo);

}
```

<br>

```xml
<!-- boardSQLMapper.xml -->

<!-- ì½”ë©˜íŠ¸ í…Œì´ë¸” -->
<insert id="insertComment">
    INSERT INTO FP_Comment VALUES (
        FP_Comment_seq.nextval,
        #{member_no}, 
        #{board_no},
        #{comment_content},
        SYSDATE
    )	
</insert>

<select id="getCommentListByBoardNo" resultType="map">
    SELECT fpc.*, fpm.member_nick
    FROM FP_Comment fpc, FP_Member fpm
    WHERE fpc.member_no = fpm.member_no
    AND fpc.board_no = #{boardNo}
    ORDER BY fpc.comment_no DESC
</select>

<delete id="deleteComment">
    DELETE FROM FP_Comment
    WHERE comment_no = #{commentNo}
</delete>

<update id="updateComment">
    UPDATE FP_Comment
    SET comment_content = #{comment_content}
    WHERE comment_no = #{comment_no}
</update>
```

<br>
<br>

## Service

```java
// BoardService

public void insertComment(CommentVO vo) {
    boardSQLMapper.insertComment(vo);
}

public void deleteComment(int commentNo) {
    boardSQLMapper.deleteComment(commentNo);
}

public void updateComment(CommentVO vo) {
    boardSQLMapper.updateComment(vo);
}

public ArrayList<HashMap<String, Object>> getCommentList(int boardNo) {
    return boardSQLMapper.getCommentListByBoardNo(boardNo);
}
```

<br>
<br>

## Controller

```java
// RestBoardController

@RequestMapping("writeComment")
public HashMap<String, Object> writeComment(CommentVO param, HttpSession session) {
    HashMap<String, Object> data = new HashMap<>();
    
    MemberVO memberVO = (MemberVO) session.getAttribute("sessionUser");
    int memberNo = memberVO.getMember_no();
    
    param.setMember_no(memberNo);
    boardService.insertComment(param);
    
    data.put("result", "success");
    
    return data;
}

@RequestMapping("deleteComment")
public HashMap<String, Object> deleteComment(int comment_no) {
    HashMap<String, Object> data = new HashMap<>();
    
    boardService.deleteComment(comment_no);
    
    data.put("result", "success");
    
    return data;
}

@RequestMapping("updateComment")
public HashMap<String, Object> updateComment(CommentVO param) {
    HashMap<String, Object> data = new HashMap<>();
    
    boardService.updateComment(param);
    
    data.put("result", "success");
    
    return data;
}

@RequestMapping("getCommentList")
public HashMap<String, Object> getCommentList(int board_no) {
    HashMap<String, Object> data = new HashMap<>();
    
    ArrayList<HashMap<String, Object>> commentList = boardService.getCommentList(board_no);
    
    data.put("result", "success");
    data.put("commentList", commentList);
    
    return data;
}
```


<br><br>

## JSP

polling ë°©ì‹ ì‚¬ìš©í•  ê²ƒ
- ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰/í™•ì¸(ex. ë°›ì€ ë©”ì¼í•¨ -> ì£¼ê¸°ì ìœ¼ë¡œ ë©”ì¼ ë°›ì•„ì˜´)
- `setInterval(refreshCommentList, 3000);`
  - 3ì´ˆì— í•œ ë²ˆì”© `refreshCommentList` í•¨ìˆ˜ í˜¸ì¶œ

<br>

Xë²„íŠ¼ ëˆŒë €ì„ ë•Œ ëŒ“ê¸€ ì‚­ì œ í›„
1. í™”ë©´ìƒ ë¦¬í”Œë°•ìŠ¤ ì‚­ì œ
  - ìœ„í—˜(DBì—ì„œ ì•„ì§ ì•ˆì§€ì›Œì¡ŒëŠ”ë° viewì—ì„œë§Œ ì§€ì›Œì§€ëŠ” ê²½ìš° ìˆìŒ)
2. **refresh**
  - ì•ˆì „(DBì™€ì˜ ì‹±í¬)

<br>
jsì—ì„œ ìˆ«ì -> ë‚ ì§œ<br>
`var dd = new Date(commentData.COMMENT_WRITEDATE);`<br>
<br>
jsì—ì„œ ë‚ ì§œ -> ë¬¸ì<br>
`dd.getFullYear();	// 2022`<br>
`dd.getMonth()+1;	// 2 (0ì´ 1ì›”)`<br>
`dd.getDate();	// 10(ì¼)`<br>


<br><br>

```jsp
<%-- readContentPage.jsp --%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<title>Insert title here</title>

<script>
	var sessionInfo = null;
	
	var board_no = ${data.boardVO.board_no };

	// ì¢‹ì•„ìš” ë¶€ë¶„ ìƒëµ
	
	function getSessionInfo() {
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				var data = JSON.parse(xhr.responseText);
				
				if(data.result != 'empty') {
					sessionInfo = {
						memberNo : data.memberNo,
						memberNick : data.memberNick
					};
				}
				
			}
			
		};
		
		xhr.open("get", "../member/getSessionInfo", false);	// false: ë™ê¸°ì‹(ì›¬ë§Œí•˜ë©´ ì“°ì§€ë§)
		xhr.send();
	}
	
	
	function writeComment() {
		if(sessionInfo == null) {
			alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤");
			return;
		}
		
		var commentInput = document.getElementById("commentInput");
		var commentValue = commentInput.value;
		
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function() {
			if(xhr.readyState == 4 && xhr.status == 200) {
				var data = JSON.parse(xhr.responseText);
				
				commentInput.value = "";
				refreshCommentList();
			}
		};
		
		xhr.open("post", "./writeComment", true);
		xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xhr.send("member_no=" + sessionInfo.memberNo + "&board_no=" + board_no + "&comment_content=" + commentValue);
		
	}
	
	function refreshCommentList() {
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function() {
			if(xhr.readyState == 4 && xhr.status == 200) {
				
				var data = JSON.parse(xhr.responseText);
							
				// ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ë Œë”ë§				
				var commentRoot = document.getElementById("commentRoot");
				commentRoot.innerHTML = "";	// ìì‹ element ì „ë¶€ ì œê±°
				
				for(commentData of data.commentList) {
					var rowBox = document.createElement("div");
					rowBox.setAttribute("class", "row commentBox");
					
					var nicknameBox = document.createElement("div");
					nicknameBox.setAttribute("class", "col-2 fw-bold bg-danger");
					nicknameBox.innerText = commentData.MEMBER_NICK;
					rowBox.appendChild(nicknameBox);
					
					var contentBox = document.createElement("div");
					contentBox.setAttribute("class", "col-6 bg-secondary");
					contentBox.innerText = commentData.COMMENT_CONTENT;
					rowBox.appendChild(contentBox);
					
					var dateBox = document.createElement("div");
					dateBox.setAttribute("class", "col-2 bg-warning");
					
					// ìˆ«ì -> ë‚ ì§œ
					var commentWriteDate = new Date(commentData.COMMENT_WRITEDATE);
					// ë‚ ì§œ -> ë¬¸ì							
					dateBox.innerText = commentWriteDate.getFullYear() + "." + 
										(commentWriteDate.getMonth()+1) + "." + 
										commentWriteDate.getDate();
					rowBox.appendChild(dateBox);
					
					if(sessionInfo != null && commentData.MEMBER_NO == sessionInfo.memberNo) {
						var deleteBox = document.createElement("div");
						deleteBox.setAttribute("class", "col-1 bg-success");
						deleteBox.setAttribute("onclick", "deleteComment("+ commentData.COMMENT_NO +")");
						deleteBox.innerText = "X";
						rowBox.appendChild(deleteBox);
						
						var updateBox = document.createElement("div");
						updateBox.setAttribute("class", "col bg-info");
						updateBox.setAttribute("onclick", "updateCommentForm(this, " + commentData.COMMENT_NO + ")");
						updateBox.innerText = "ìˆ˜ì •";
						rowBox.appendChild(updateBox);
					}
					commentRoot.appendChild(rowBox);
				}								
			}
		};
		
		xhr.open("get", "./getCommentList?board_no=" + board_no, true);
		xhr.send();
				
	}
	
	function updateCommentForm(target, commentNo) {			
				
		var commentBox = target.closest(".commentBox");
		
		var commentValue = commentBox.children[1].innerText;
		
		commentBox.innerHTML = "";
		
		var textCol = document.createElement("div");
		textCol.setAttribute("class", "col-8");
		var textBox = document.createElement("textarea");
		textBox.setAttribute("class", "form-controll");
		textBox.value = commentValue;
		textCol.appendChild(textBox);
		
		var inputButtonCol = document.createElement("div");
		inputButtonCol.setAttribute("class", "col-2 d-grid");
		var inputButton = document.createElement("button");
		inputButton.setAttribute("class", "btn btn-primary");
		inputButton.setAttribute("onclick", "updateComment(this, " + commentNo + ")");
		inputButton.innerText = "ì…ë ¥";
		inputButtonCol.appendChild(inputButton);
		
		var cancelUpdateFormCol = document.createElement("div");
		cancelUpdateFormCol.setAttribute("class", "col-2 d-grid");
		var cancelButton = document.createElement("button");
		cancelButton.setAttribute("class", "btn btn-outline-primary");
		cancelButton.setAttribute("onclick", "refreshCommentList()");
		cancelButton.innerText = "ì·¨ì†Œ";
		cancelUpdateFormCol.appendChild(cancelButton);
		
		commentBox.appendChild(textCol);
		commentBox.appendChild(inputButtonCol);
		commentBox.appendChild(cancelUpdateFormCol);
	}
	
	function updateComment(target, commentNo) {
		var commentBox = target.closest(".commentBox");
		var commentValue = commentBox.querySelector("textarea").value;
		
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function() {
			if(xhr.readyState == 4 && xhr.status == 200) {
				var data = JSON.parse(xhr.responseText);
				
				refreshCommentList();
			}
		};
		
		xhr.open("post", "./updateComment", true);
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.send("comment_no=" + commentNo + "&comment_content=" + commentValue);
	}
	
	function deleteComment(commentNo) {
		var xhr = new XMLHttpRequest();
		
		xhr.onreadystatechange = function() {
			if(xhr.readyState == 4 && xhr.status == 200) {
				var data = JSON.parse(xhr.responseText);
				
				refreshCommentList();
			}
		};
		
		xhr.open("post", "./deleteComment", true);
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.send("comment_no=" + commentNo);
	}
	
	window.addEventListener("DOMContentLoaded", function(){
		getSessionInfo();
		refreshTotalCount();
		refreshHeart();
		refreshCommentList();
		
		//setInterval(refreshCommentList, 3000);
	});
</script>

</head>
<body>
	<h1>${data.boardVO.board_title }</h1>
	
	ì‘ì„±ì : ${data.memberVO.member_nick }<br>
	ì‘ì„±ì¼ : ${data.boardVO.board_writedate }<br>
	ì¡°íšŒìˆ˜ : ${data.boardVO.board_readcount }<br>
	
	ì´ë¯¸ì§€ : <br>
	<c:forEach items="${data.boardImageVOList }" var="boardImageVO">
		<img src="/upload/${boardImageVO.image_url }"><br>
	</c:forEach>
	
	
	ë‚´ìš© :<br>
	${data.boardVO.board_content }<br>
	
	<br>
	<i id="heartBox" class="bi bi-heart fs-1 text-danger" onclick="doLike()"></i>
	<br>
	ì¢‹ì•„ìš” ìˆ˜ : <span id="totalLikeCountBox"></span>
	<br>
	
	<br><a href="./mainPage">ëª©ë¡ìœ¼ë¡œ</a>
	
	<!-- ë¡œê·¸ì¸+ë³¸ì¸ì´ ì“´ ê¸€ì¼ê²½ìš° ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ ë‚˜íƒ€ë‚¨ -->
	<c:if test="${!empty sessionUser && sessionUser.member_no == data.boardVO.member_no }">
	<a href="./deleteContentProcess?board_no=${data.boardVO.board_no }">ì‚­ì œ</a>
	<a href="./updateContentPage?board_no=${data.boardVO.board_no }">ìˆ˜ì •</a>
	</c:if>
	
	
	<div class="container-fluid">
		<div class="row">
			<div class="col-8">
				<textarea id="commentInput" class="form-control" placeholder="ëŒ“ê¸€ ì…ë ¥í•˜ì„¸ìš”"></textarea>
			</div>
			<div class="col d-grid">
				<button class="btn btn-outline-danger" onclick="writeComment()">ì…ë ¥</button>
			</div>
		</div>
		
		<div class="row"> <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ë£¨íŠ¸ -->
			<div class="col" id="commentRoot">
										
			</div>
		</div>
		
	</div>
	
	
	
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>	
</body>
</html>
```














<br>
<br><br>